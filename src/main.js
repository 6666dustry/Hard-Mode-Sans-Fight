(()=>{"use strict";var t,e,s,i,n,o,a,r,h={d:(t,e)=>{for(var s in e)h.o(e,s)&&!h.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};h.d({},{k:()=>$s}),function(t){t.battleScene="battleScene",t.mainMenu="mainMenu",t.gameOver="gameOver",t.singleSelect="singleSelect",t.setting="setting",t.pause="pauseScene"}(t||(t={})),function(t){t.heart="heart",t.block="whiteBlock",t.target="target",t.HPfont="HPfont",t.KRfont="KRfont",t.bone="sansBone",t.particleBone="particleBone",t.break="brakedHeart",t.speech="speechBubble"}(e||(e={})),function(t){t.fight="fight",t.act="act",t.item="item",t.mercy="mercy",t.tagBar="targetBar",t.attacked="playerAttacked",t.sansHead="sansHead",t.sansTorso="sansTorso",t.sansLeg="sansLeg",t.sansSweet="sansSweet",t.shard="heartShard",t.blaster="gasterBlaster",t.platForm="platForm1"}(s||(s={})),function(t){t.battleText="battleTextSound",t.sansText="sansTextSound",t.cursor="cursorSound",t.select="selectSound",t.fight="playerFight",t.heal="playerHeal",t.damage="playerDamage",t.shatter="heartShatterSound",t.split="heartSplitSound",t.BGM="backGroundMusic",t.blast0="gasterBlasterBlast0",t.blast1="gasterBlasterBlast1",t.blaster="gasterBlasterSound",t.slam="sansSlamSound",t.warning="warningSound",t.boneStab="boneStabSound",t.ding="dingSound",t.flash="flashSound"}(i||(i={})),function(t){t.attackProto="attack",t.attack="attackPlayOrder"}(n||(n={})),function(t){t.barFlash="attackBarFlash",t.attacking="playerAttacking",t.blastStart="gasterBlastStart",t.blasting="gasterBlasting",t.downSlam="sansDownSlam",t.leftSlam="sansLeftSlam",t.flashEyes="sansFlashEyes"}(o||(o={})),function(t){t.endTurn="endPlayerTurn",t.endRoll="endTextRoll"}(a||(a={})),function(t){t.batTime="* You feel like you're going to\n have a bad time",t.resting="* Sans is sparing you."}(r||(r={}));var c,l,d,u=0;!function(t){t[t.backGround=u]="backGround",t[t.command=++u]="command",t[t.sans=u]="sans",t[t.sansText=u]="sansText",t[t.statuses=u]="statuses",t[t.combatDisplay=++u]="combatDisplay",t[t.combatzone=++u]="combatzone",t[t.bone=++u]="bone",t[t.platform=u]="platform",t[t.blaster=u]="blaster",t[t.heart=++u]="heart",t[t.debug=++u]="debug"}(c||(c={})),function(t){t[t.white=16777215]="white",t[t.blue=52479]="blue",t[t.orange=16756736]="orange",t[t.green=43520]="green",t[t.purple=16711935]="purple"}(l||(l={})),function(t){t.up="up",t.down="down",t.right="right",t.left="left",t.platform="platform",t.heart="heart"}(d||(d={}));const p={Image:e,Sheet:s,Audio:i,Json:n,Anim:o,Event:a,Text:r,Depth:c,Scene:t,Color:l,Label:d,MASS:100,ZONE:["up","left","down","right"],preFix:"data/attacks/",Item:{pie:{name:"Pie",displayName:"Butterscotch Pie",amount:99},noodle:{name:"I.noodle",displayName:"Instant Noodle",amount:90},steak:{name:"Steak",displayName:"Face Steak",amount:60},snowPiece:{name:"S.Piece",displayName:"Snowman Piece",amount:45},lHero:{name:"L.Hero",displayName:"Legendary Hero",description:"* ATTACK increased by 4!",amount:40}}},g=function(){function t(t){this.lightLength=30,this.scene=t,t.tweens.add({targets:this,props:{lightLength:"+=50"},duration:2500,repeat:-1,yoyo:!0,ease:"Quad.easeInOut"}),this.UnderLight=t.add.graphics(),this.UnderLight.fillGradientStyle(0,0,16711680,16711680),this.UnderLight.fillRect(0,t.scale.height-this.lightLength,t.scale.width,this.lightLength),this.UnderLight.setDepth(p.Depth.backGround),this.UnderLight.setScrollFactor(0,0),this.RainBone=t.add.particles(p.Image.particleBone,void 0,[{lifespan:8e3,x:{min:0,max:t.scale.width},y:0,speedY:{min:50,max:100},speedX:{min:10,max:20},scale:{min:.5,max:.6},frequency:600,rotate:{start:-360,end:360,random:!0},alpha:{start:.8,end:0}},{lifespan:6e3,x:{min:0,max:t.scale.width},y:0,speedY:{min:100,max:200},speedX:{min:15,max:30},scale:{min:.6,max:.8},frequency:600,rotate:{start:-360,end:360,random:!0},alpha:{start:.9,end:0}},{lifespan:4e3,x:{min:0,max:t.scale.width},y:0,speedY:{min:200,max:300},speedX:{min:20,max:40},scale:{min:.8,max:1},frequency:600,rotate:{start:-360,end:360,random:!0},alpha:{start:1,end:0}}]).setDepth(p.Depth.backGround)}return t.prototype.update=function(){this.UnderLight.clear(),this.UnderLight.fillGradientStyle(0,0,16711680,16711680),this.UnderLight.fillRect(0,this.scene.scale.height-this.lightLength,this.scene.scale.width,this.lightLength)},t}();var y=function(){function t(t){this.scene=t,this.w=t.input.keyboard.addKey("W"),this.a=t.input.keyboard.addKey("A"),this.s=t.input.keyboard.addKey("S"),this.d=t.input.keyboard.addKey("D"),this.up=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP),this.left=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.down=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN),this.right=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.upKeys=[this.up,this.w],this.leftKeys=[this.left,this.a],this.downKeys=[this.down,this.s],this.rightKeys=[this.right,this.d],this.space=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.shift=t.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT)}return Object.defineProperty(t.prototype,"upIsDown",{get:function(){for(var t=0,e=this.upKeys;t<e.length;t++)if(e[t].isDown)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftIsDown",{get:function(){for(var t=0,e=this.leftKeys;t<e.length;t++)if(e[t].isDown)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"downIsDown",{get:function(){for(var t=0,e=this.downKeys;t<e.length;t++)if(e[t].isDown)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightIsDown",{get:function(){for(var t=0,e=this.rightKeys;t<e.length;t++)if(e[t].isDown)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upIsUp",{get:function(){for(var t=0,e=this.upKeys;t<e.length;t++)if(e[t].isUp)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftIsUp",{get:function(){for(var t=0,e=this.leftKeys;t<e.length;t++)if(e[t].isUp)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"downIsUp",{get:function(){for(var t=0,e=this.downKeys;t<e.length;t++)if(e[t].isUp)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightIsUp",{get:function(){for(var t=0,e=this.rightKeys;t<e.length;t++)if(e[t].isUp)return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upIsJustDown",{get:function(){for(var t=0,e=this.upKeys;t<e.length;t++){var s=e[t];if(Phaser.Input.Keyboard.JustDown(s))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftIsJustDown",{get:function(){for(var t=0,e=this.leftKeys;t<e.length;t++){var s=e[t];if(Phaser.Input.Keyboard.JustDown(s))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"downIsJustDown",{get:function(){for(var t=0,e=this.downKeys;t<e.length;t++){var s=e[t];if(Phaser.Input.Keyboard.JustDown(s))return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightIsJustDown",{get:function(){for(var t=0,e=this.rightKeys;t<e.length;t++){var s=e[t];if(Phaser.Input.Keyboard.JustDown(s))return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.detectKeys=function(t,e){var s;s="up"===e.type?"Up":"Down";for(var i=0,n=this["".concat(t,"Keys")];i<n.length;i++){var o=n[i];if(e.just){if(Phaser.Input.Keyboard["Just".concat(s)](o))return!0}else if(o["is".concat(s)])return!0}},t.prototype.getDownKey=function(){var t=[];for(var e in this)if(Object.prototype.hasOwnProperty.call(this,e)){var s=this[e];s instanceof Phaser.Input.Keyboard.Key&&s.isDown&&t.push(e)}return t.length<=0&&(t[0]="nothing"),t},t}();const f=y;var m,b=(m=function(t,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},m(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),v=function(t){function e(){var e=t.call(this,p.Scene.mainMenu)||this;return e.textSets=[],e.texts=[],e.selected=0,e.Phase1=[],e.Phase2=[],e.Phase1RND=[],e.Phase2RND=[],e.shakePower=30,e}return b(e,t),e.prototype.preload=function(){var t=this.add.graphics(),e=this.add.text(320,150,"loading...",{fontFamily:"battlefont",fontSize:"60px"}).setOrigin(.5),s=Phaser.Display.Color.HSVColorWheel();this.load.on("progress",(function(i){if(t.clear(),t.fillStyle(16777215,1),s){var n=Math.floor(i*s.length-1);if(n>=0){var o=65535*s[n].r+255*s[n].g+s[n].b;e.setTint(o);var a=s.length-1-n,r=65535*s[a].r+255*s[a].g+s[a].b;t.fillStyle(16777215-r)}}t.fillRect(0,180,640*i,60)})),this.load.on("complete",(function(){t.destroy(),e.destroy()}));for(var i=0,n=[[p.Image.heart,"image/heart/heart.png"],[p.Image.break,"image/heart/breakedheart.png"],[p.Image.block,"image/battlezone/whiteblock.png"],[p.Image.HPfont,"image/commands/HP.png"],[p.Image.KRfont,"image/commands/KR.png"],[p.Image.speech,"image/sans/speechbubble.png"],[p.Sheet.fight,"image/commands/fight.png",{frameWidth:112,frameHeight:44}],[p.Sheet.act,"image/commands/act.png",{frameWidth:112,frameHeight:44}],[p.Sheet.item,"image/commands/item.png",{frameWidth:112,frameHeight:44}],[p.Sheet.mercy,"image/commands/mercy.png",{frameWidth:112,frameHeight:44}],[p.Image.target,"image/commands/target.png"],[p.Sheet.tagBar,"image/commands/targetBar.png",{frameWidth:16,frameHeight:131}],[p.Image.bone,"image/attack/bone.png",{frameWidth:12,frameHeight:6}],[p.Image.particleBone,"image/attack/bone.png"],[p.Sheet.shard,"image/heart/shard.png","image/heart/shard_atlas.json"],[p.Sheet.attacked,"image/commands/strike.png","image/commands/strike_atlas.json"],[p.Sheet.sansHead,"image/sans/head.png","image/sans/head_atlas.json"],[p.Sheet.sansTorso,"image/sans/torsoes.png","image/sans/torsoes_atlas.json"],[p.Sheet.sansLeg,"image/sans/leg.png"],[p.Sheet.sansSweet,"image/sans/sweet.png","image/sans/sweet_atlas.json"],[p.Sheet.blaster,"image/gasterblaster/gasterblaster.png","image/gasterblaster/gasterblaster_atlas.json"],[p.Sheet.platForm,"image/platform/Platform1.png","image/platform/platform1_atlas.json"],[p.Audio.battleText,"media/battletext.ogg"],[p.Audio.sansText,"media/SansSpeak.ogg"],[p.Audio.cursor,"media/MenuCursor.ogg"],[p.Audio.select,"media/MenuSelect.ogg"],[p.Audio.fight,"media/PlayerFight.ogg"],[p.Audio.heal,"media/PlayerHeal.ogg"],[p.Audio.damage,"media/PlayerDamaged.ogg"],[p.Audio.shatter,"media/HeartShatter.ogg"],[p.Audio.split,"media/HeartSplit.ogg"],[p.Audio.BGM,"media/mus_zz_megalovania.ogg"],[p.Audio.blast0,"media/GasterBlast.ogg"],[p.Audio.blast1,"media/GasterBlast2.ogg"],[p.Audio.blaster,"media/GasterBlaster.ogg"],[p.Audio.slam,"media/Slam.ogg"],[p.Audio.warning,"media/Warning.ogg"],[p.Audio.boneStab,"media/BoneStab.ogg"],[p.Audio.ding,"media/Ding.ogg"],[p.Audio.flash,"media/Flash.ogg"]];i<n.length;i++){var o=n[i];switch(o[1].slice(-3)){case"ogg":this.load.audio(o[0],o[1]);break;case"png":o[2]?"string"==typeof o[2]?"json"===o[2].slice(-4)&&this.load.atlas(o[0],o[1],o[2]):this.load.spritesheet(o[0],o[1],o[2]):this.load.image(o[0],o[1]);break;case"xml":this.load.xml(o[0],o[1])}}this.load.json("menutext","data/menutext.json"),this.load.json(p.Json.attack,"data/attacks/attackloader.json")},e.prototype.create=function(t){this.sound.stopAll(),this.BackGround=new g(this),this.AttackOrders=this.cache.json.get(p.Json.attack);for(var e=0;e<this.AttackOrders.Phase1.length;e++)"string"==typeof(s=this.AttackOrders.Phase1[e])&&"json"===s.slice(-4)?(this.load.json(s,p.preFix+s),this.Phase1[e]=s):console.error("error attack name in"+s);for(e=0;e<this.AttackOrders.Phase2.length;e++)"string"==typeof(s=this.AttackOrders.Phase2[e])&&"json"===s.slice(-4)?(this.load.json(s,p.preFix+s),this.Phase2[e]=s):console.error("error attack name in"+s);for(e=0;e<this.AttackOrders.Phase1RND.length;e++)"string"==typeof(s=this.AttackOrders.Phase1RND[e])&&"json"===s.slice(-4)?(this.load.json(s,p.preFix+s),this.Phase1RND[e]=s):console.error("error attack name in"+s);for(e=0;e<this.AttackOrders.Phase2RND.length;e++){var s;"string"==typeof(s=this.AttackOrders.Phase2RND[e])&&"json"===s.slice(-4)?(this.load.json(s,p.preFix+s),this.Phase2RND[e]=s):console.error("error attack name in"+s)}this.load.start(),this.tweens.add({targets:this.cameras.main,props:{scrollY:"+=".concat(this.shakePower)},duration:2500,repeat:-1,yoyo:!0,ease:"Quad.easeInOut"}),this.textSets=this.cache.json.get("menutext").textSets,this.cursors=new f(this),this.selector=this.add.image(190,115,p.Image.heart),this.selector.setTint(16711680),this.config=t||{},this.config.Phase1=this.Phase1,this.config.Phase1RND=this.Phase1RND,this.config.Phase2=this.Phase2,this.config.Phase2RND=this.Phase2RND,this.zKey=this.input.keyboard.addKey("Z");for(var i=0,n=this.textSets;i<n.length;i++){var o=n[i];this.texts.push(this.add.text(o[0],o[1],o[2],o[3]).setScale(.5))}this.add.text(this.scale.width/2,this.scale.height/4,"Hard Mode Sans Fight",{fontFamily:"battlefont",fontSize:"60px"}).setOrigin(.5),this.title=this.add.text(this.scale.width,this.scale.height,"    version: not ready (beta)",{fontFamily:"battlefont",fontSize:"20px"}).setOrigin(1)},e.prototype.update=function(){if(this.BackGround.update(),this.cursors.upIsJustDown&&(this.selected<=0||this.selected--,this.sound.play(p.Audio.cursor)),this.cursors.downIsJustDown&&(this.selected>=this.textSets.length-1||this.selected++,this.sound.play(p.Audio.cursor)),Phaser.Input.Keyboard.JustDown(this.zKey)){switch(this.selected){case 0:this.config.single=!1,this.config.singleAttack=void 0,this.scene.start(p.Scene.battleScene,this.config);break;case 1:this.scene.start(p.Scene.singleSelect,this.config);break;case 2:this.scene.start(p.Scene.setting,this.config)}this.sound.play(p.Audio.select)}this.selector.setPosition(this.textSets[this.selected][0]-30,this.textSets[this.selected][1]+15)},e}(Phaser.Scene);const x=v;function w(t,e,s,i){var n=Object.keys(e);null!=t&&"object"==typeof t||console.error("data is not object at ".concat(s," "));for(var o=0,a=n;o<a.length;o++){var r=e[f=a[o]],h=t[f];if("object"!=typeof r||Array.isArray(r))if(null==h&&console.error("".concat(String(f)," is not defined at ").concat(s)),Array.isArray(r)){d=!1;for(var c=0,l=r;c<l.length;c++)if(typeof h===l[c]){d=!0;break}d||console.error("".concat(String(f)," is not ").concat(r.join(" or ")," at ").concat(s))}else typeof h!==r&&console.error("".concat(String(f)," is not ").concat(r," at ").concat(s));else{if(null==h){t[f]=r.default;continue}if(Array.isArray(r.type)){for(var d=!1,u=0,p=r.type;u<p.length;u++)if(typeof h===p[u]){d=!0;break}d||console.error("".concat(String(f)," is not ").concat(r.type.join(" or ")," at ").concat(s))}else typeof h!==r.type&&(console.error("".concat(String(f)," is not ").concat(r.type," at ").concat(s)),t[f]=r.default)}}t:for(var g=0,y=Object.keys(t);g<y.length;g++){var f=y[g];for(var m in i)if(Object.prototype.hasOwnProperty.call(i,m)&&(r=i[m])&&m===f)continue t;null==e[f]&&console.warn("".concat(String(f)," is not defined at ").concat(s))}return t}function A(t,e){var s,i,n,o,a,r,h,c,l=w(t,{x:{type:"number",default:this.RectSize.x-("number"==typeof t.relPointX?t.relPointX:0)},y:{type:"number",default:this.RectSize.y-("number"==typeof t.relPointY?t.relPointY:0)},dx:{type:"number",default:this.RectSize.right-("number"==typeof t.relPointX?t.relPointX:0)},dy:{type:"number",default:this.RectSize.bottom-("number"==typeof t.relPointY?t.relPointY:0)},duration:{type:"number",default:500},inst:{type:"boolean",default:!1},relPointX:{type:"number",default:0},relPointY:{type:"number",default:0},ease:{type:"string",default:"Linear"},zone:{type:"string",default:"main"}},this.director.AttackLoader.runAttackPos);if(h=l.relPointX,c=l.relPointY,s=l.x+h,i=l.y+c,s>(n=l.dx+h)){var d=n;n=s,s=d}i>(o=l.dy+c)&&(d=o,o=i,i=d),a=l.duration,r=l.inst,this.scene.tweens.killTweensOf(this.RectSize),r||e?(this.boxX=s,this.boxY=i,this.boxDx=n,this.boxDy=o):this.scene.tweens.add({targets:this.RectSize,props:{x:s,y:i,right:n,bottom:o},duration:a,ease:t.ease}),this.moving=!0}function k(t,e){if(e){this.RenderZone.clear(),this.RenderZone.beginDraw(),this.RenderZone.batchDraw(this.Background,this.Background.x-this.RenderZone.x,this.Background.y-this.RenderZone.y);for(var s=0;s<t.length;s++){var i=t[s];i instanceof Phaser.GameObjects.Text||i instanceof Phaser.GameObjects.Sprite||i instanceof Phaser.GameObjects.Graphics?i.active?this.RenderZone.batchDraw(i,i.x-this.RenderZone.x,i.y-this.RenderZone.y):t.splice(s,1):i.destroyed||i.visible?(i.onRender=!1,t.splice(s,1)):i.body&&this.RenderZone.batchDraw(i,i.x-this.RenderZone.x,i.y-this.RenderZone.y)}this.RenderZone.endDraw()}else{t:for(var n=0,o=this.scene.tweens.getTweensOf(this.RectSize);n<o.length;n++)if(o[n]){this.moving=!0;break t}if(this.moving){var a=2*this.thickness,r=.5*this.thickness;this.up.setDisplaySize(this.RectSize.width+a,this.thickness),this.up.setPosition(this.RectSize.centerX,this.RectSize.top-r),this.down.setDisplaySize(this.RectSize.width+a,this.thickness),this.down.setPosition(this.RectSize.centerX,this.RectSize.bottom+r),this.left.setDisplaySize(this.thickness,this.RectSize.height+a),this.left.setPosition(this.RectSize.left-r,this.RectSize.centerY),this.right.setDisplaySize(this.thickness,this.RectSize.height+a),this.right.setPosition(this.RectSize.right+r,this.RectSize.centerY),this.RectBox&&(this.RectBox.clear(),this.RectBox.strokeRectShape(this.RectSize)),this.RenderZone.setPosition(this.RectSize.x,this.RectSize.y),this.RenderZone.resize(this.RectSize.width,this.RectSize.height),this.Background.setPosition(this.RectSize.x,this.RectSize.y),this.Background.setSize(this.RectSize.width,this.RectSize.height)}}}function P(t){var e=w(t,{left:{type:["string","boolean"],default:!1},right:{type:["string","boolean"],default:!1},top:{type:["string","boolean"],default:!1},bottom:{type:["string","boolean"],default:!1},width:{type:["string","boolean"],default:!1},height:{type:["string","boolean"],default:!1},centerX:{type:["string","boolean"],default:!1},centerY:{type:["string","boolean"],default:!1},zone:{type:"string",default:"main"}},this.director.AttackLoader.runAttackPos),s=this.director.GameMath.variables;e.bottom&&(s[e.bottom]=this.boxDy),e.right&&(s[e.right]=this.boxDx),e.top&&(s[e.top]=this.boxY),e.left&&(s[e.left]=this.boxX),e.centerX&&(s[e.centerX]=this.midPoint.x),e.centerY&&(s[e.centerY]=this.midPoint.y),e.width&&(s[e.width]=this.RectSize.width),e.height&&(s[e.height]=this.RectSize.height)}var S=0;function T(t){var e;if(++S<=10)return S=0,t;if("object"==typeof t){if(null===t)return t;if(Array.isArray(t)){e=[];for(var s=0;s<t.length;s++)"object"==typeof(n=t[s])?e[s]=T(n):e[s]=n;return e}for(var i in e={},t){var n;"object"==typeof(n=t[i])?e[i]=T(n):e[i]=n}}return t}function D(t,e,s,i){if(s.targets=e,i&&s.props)for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)&&s.props[n]){var o=i[n];s.props[o]=T(s.props[n]),delete s.props[n]}if(s.props)for(var a=0,r=Object.keys(s.props);a<r.length;a++)null==e[n=r[a]]?console.warn("".concat(n," is not defined at add tween.")):"number"!=typeof e[n]&&console.warn("".concat(n," is not number at add tween."));t.tweens.add(s)}function C(t,e,s,i){var n=T(s);if(Array.isArray(n))for(var o=0,a=n;o<a.length;o++)D(t,e,a[o],i);else D(t,e,n,i)}function I(t){var e=w(t,{zone:{type:"string",default:"main"},tween:"object"},this.director.AttackLoader.runAttackPos);if(this.scene.tweens.killTweensOf(this.RectSize),e.tween){this.moving=!0;var s=T(e.tween);C(this.scene,this.RectSize,s)}else console.error("tween is not defined at ".concat(this.director.AttackLoader.runAttackPos))}function O(t,e){if(null!=this[e]&&"function"==typeof this[e])return this[e](t);console.error("type is name not defined at ".concat(this.director.AttackLoader.runAttackPos,"\n        type ").concat(e))}var R=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),M=function(t){function e(e,s,i,n,o){var a=t.call(this,e)||this;e.add.existing(a),a.collide=s,a.heartCol=i,a.director=n,a.CombatZoneDirector=o;var r=o.menuRect;a.RectSize=new Phaser.Geom.Rectangle(r.x,r.y,r.dx-r.x,r.dy-r.y),a.moving=!1,a.thickness=o.thickness,$s&&(a.RectBox=e.add.graphics({x:0,y:0,lineStyle:{color:255,width:1.5,alpha:.5}}),a.RectBox.setDepth(p.Depth.debug));for(var h=p.Image.block,c=0,l=["up","down","left","right"];c<l.length;c++){var d=l[c];a[d]=e.matter.add.sprite(0,0,h),a.add(a[d]),a[d].setCollisionCategory(a.collide),a[d].setCollidesWith(a.heartCol),a[d].state=d,a[d].body.label=p.Label[d],a[d].setStatic(!0),a[d].setFriction(0,0,0)}return a.setDepth(p.Depth.combatzone),a.RenderZone=e.add.renderTexture(a.RectSize.x,a.RectSize.y,a.RectSize.width,a.RectSize.height),a.RenderZone.setDepth(p.Depth.combatDisplay),a.RenderZone.camera.roundPixels=!0,a.Background=e.add.rectangle(a.RectSize.x,a.RectSize.y,a.RectSize.width,a.RectSize.height,0),a.Background.visible=!1,a.Background.setOrigin(0),a.setRect=A,a.getPos=P,a.tweenRect=I,a.update=k,a.setRect(r,!0),a}return R(e,t),Object.defineProperty(e.prototype,"boxX",{get:function(){return this.RectSize.x},set:function(t){this.RectSize.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boxY",{get:function(){return this.RectSize.y},set:function(t){this.RectSize.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boxDx",{get:function(){return this.RectSize.right},set:function(t){this.RectSize.right=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boxDy",{get:function(){return this.RectSize.bottom},set:function(t){this.RectSize.bottom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midPoint",{get:function(){return new Phaser.Math.Vector2(this.RectSize.centerX,this.RectSize.centerY)},enumerable:!1,configurable:!0}),e.prototype.router=function(t,e){return"getPosition"===e&&(e="getPos"),O.call(this,t,e),!0},e}(Phaser.GameObjects.Group);const j=M;function L(t){this.removeAll(),this.Zones.main.setRect(this.menuRect,t)}function B(t,e){return this.Zones[t.zone||"main"].router(t,e)}function _(t){return this.Zones[t||"main"]}function E(t,e){var s;for(var i in"number"==typeof t?(null==e&&(e=t),s=new Phaser.Geom.Point(t,e)):s=t,this.Zones)if(Object.prototype.hasOwnProperty.call(this.Zones,i)){var n=this.Zones[i];if(Phaser.Geom.Rectangle.ContainsPoint(n.RectSize,s))return n}return!1}function K(){for(var t in this.Zones)if(Object.prototype.hasOwnProperty.call(this.Zones,t)){var e=this.Zones[t];if("main"===t)continue;e.clear(!1,!0)}}var H=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const z=function(t){function e(e,s,i,n){var o=t.call(this,e)||this;return o.collide=s,o.heartCol=i,o.director=n,o.draws=[],o.menuRect={x:30,y:250,dx:600,dy:385,duration:200,inst:!1,zone:"main",ease:"Linear",relPointX:0,relPointY:0},o.thickness=6,o.setRectDefault=L,o.router=B,o.getZone=_,o.getIn=E,o.removeAll=K,o.Zones={main:new j(e,s,i,n,o)},o}return H(e,t),Object.defineProperty(e.prototype,"midDialogPoint",{get:function(){var t=(this.menuRect.x+this.menuRect.dx)/2,e=(this.menuRect.y+this.menuRect.dy)/2;return new Phaser.Math.Vector2(t,e)},enumerable:!1,configurable:!0}),e.prototype.update=function(t){for(var e in this.Zones)Object.prototype.hasOwnProperty.call(this.Zones,e)&&this.Zones[e].update(this.draws,t)},e}(Phaser.GameObjects.Group);function F(t,e){this.setCollisionGravity();var s=[!0,!0,!0,!0];switch(this.gravityDirection){case"up":case"down":s[0]=!1,s[1]=!1;break;case"left":case"right":s[2]=!1,s[3]=!1}this.Image.setTint(255);var i,n=this.scene.xKey.isDown?this.slowSpeed:this.normalSpeed;switch(s[0]&&t.upIsDown&&(this.Force.y=-n),s[1]&&t.downIsDown&&(this.Force.y=n),s[2]&&t.leftIsDown&&(this.Force.x=-n),s[3]&&t.rightIsDown&&(this.Force.x=n),this.gravityDirection){case"up":i="down";break;case"down":i="up";break;case"left":i="right";break;case"right":i="left"}if(this.canJump&&!t["".concat(i,"IsDown")]&&(this.jumped=!1,this.jumpTime=e+300),this.jumpTime>e&&t["".concat(i,"IsDown")]&&!this.jumped?(this.onJump(),this.jumping=!0):this.canJump||(this.onGravity(),this.jumping=!1),t.detectKeys(i,{type:"up",just:!0})&&!this.isFalling){switch(this.gravityDirection){case"up":case"down":this.Force.y*=.2;break;case"left":case"right":this.Force.x*=.2}this.jumped=!0}s[0]&&!t.upIsDown&&this.Force.y<0&&(this.Force.y=0),s[1]&&!t.downIsDown&&this.Force.y>0&&(this.Force.y=0),s[2]&&!t.leftIsDown&&this.Force.x<0&&(this.Force.x=0),s[3]&&!t.rightIsDown&&this.Force.x>0&&(this.Force.x=0),s[2]&&t.leftIsDown&&s[3]&&t.rightIsDown&&(this.Force.x=0),s[0]&&t.upIsDown&&s[1]&&t.downIsDown&&(this.Force.y=0)}function G(t){"red"===this.color?this.Image.setTint(16711680):this.Image.setTint(255);var e=this.scene.xKey.isDown?this.slowSpeed:this.normalSpeed;t.leftIsDown&&(this.Force.x=-e),t.rightIsDown&&(this.Force.x=e),t.upIsDown&&(this.Force.y=-e),t.downIsDown&&(this.Force.y=e),(!t.leftIsDown&&!t.rightIsDown||t.leftIsDown&&t.rightIsDown)&&(this.Force.x=0),(!t.upIsDown&&!t.downIsDown||t.upIsDown&&t.downIsDown)&&(this.Force.y=0)}function N(t){var e=this;if(t.direction&&(this.gravityDirection=t.direction),t.slam){var s=this.Image.displayWidth/2;this.slamming=!0,this.setDirection();var i=function(){e.Force={x:0,y:0},e.Image.setVelocity(0)};if(this.scene.cameras.main.shake(100,.01),this.Image.body){var n=this.director.CombatzoneDirector.getIn(this.Image.x,this.Image.y);if(n){switch(t.direction||this.gravityDirection){case"up":this.scene.tweens.add({targets:this.Image,props:{y:n.boxY+s},onComplete:i,onCompleteScope:this,duration:50});break;case"down":this.scene.tweens.add({targets:this.Image,props:{y:n.boxDy-s},onComplete:i,onCompleteScope:this,duration:50});break;case"right":this.scene.tweens.add({targets:this.Image,props:{x:n.boxDx-s},onComplete:i,onCompleteScope:this,duration:50});break;case"left":this.scene.tweens.add({targets:this.Image,props:{x:n.boxX+s},onComplete:i,onCompleteScope:this,duration:50})}this.scene.sound.play(p.Audio.slam)}}}}function V(t){var e=w(t,{direction:{type:["string","boolean"],default:!1},slam:{type:"boolean",default:!1},slamAnim:{type:["boolean","string"],default:!1},color:{type:["string","boolean"],default:!1},autoInit:{type:"boolean",default:!1},playSound:{type:"boolean",default:!1},takeDamage:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos);if(e.slamAnim){var s={target:"torso",anim:"string"==typeof e.slamAnim?e.slamAnim:e.slamAnim?"".concat(e.direction||"down","Slam"):void 0,autoInit:e.autoInit};this.director.Sans.setVisual(s),this.scene.time.delayedCall(300,N,[e],this)}else N.call(this,e);e.color&&this.setColor({color:e.color}),e.playSound&&this.scene.sound.play(p.Audio.ding),e.takeDamage&&(this.director.Statuses.hp>1&&(this.director.Statuses.hp--,this.director.Statuses.setDisplay()),this.scene.sound.play(p.Audio.damage))}function Y(){var t=this.Image.setAngle.bind(this.Image);if("red"===this.color)return t(0),this.gravityDirection="down",0;switch(this.gravityDirection){case"up":return t(180),180;case"down":return t(0),0;case"left":return t(90),90;case"right":return t(270),270}}function W(t){this.colliding=t.collision.bodyA.label,t.collision.bodyA,this.colliding===p.Label.heart&&(this.colliding=t.collision.bodyB.label,t.collision.bodyB),this.slamming=!1;for(var e=0,s=0,i=0,n=0,o=function(t,e,s){if(s||2===arguments.length)for(var i,n=0,o=e.length;n<o;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}([],t.collision.supports,!0),a=0;a<o.length;a++)for(var r=o[a],h=0;h<o.length;h++)a!==h&&Phaser.Math.Distance.BetweenPoints(r,o[h])<1&&o.splice(a,1);if(1===o.length)o[0].y>this.Image.y+this.Image.displayHeight/3&&(this.collidingAt.bottom=!0),o[0].y<this.Image.y-this.Image.displayHeight/3&&(this.collidingAt.top=!0),o[0].x<this.Image.x-this.Image.displayWidth/3&&(this.collidingAt.left=!0),o[0].x>this.Image.x+this.Image.displayWidth/3&&(this.collidingAt.right=!0);else for(var c=0,l=o;c<l.length;c++){var d=l[c];d.y>this.Image.y&&n++,n>=2&&(this.collidingAt.bottom=!0),d.y<this.Image.y&&i++,i>=2&&(this.collidingAt.top=!0),d.x<this.Image.x&&e++,e>=2&&(this.collidingAt.left=!0),d.x>this.Image.x&&s++,s>=2&&(this.collidingAt.right=!0)}switch(this.gravityDirection){case"down":this.canJump=this.collidingAt.bottom;break;case"up":this.canJump=this.collidingAt.top;break;case"left":this.canJump=this.collidingAt.left;break;case"right":this.canJump=this.collidingAt.right}}function X(){var t=this.Image.body;switch(this.gravityDirection){case"up":return t.velocity.y<=0;case"down":return t.velocity.y>=0;case"right":return t.velocity.x>=0;case"left":return t.velocity.x<=0}}function Z(t){var e=t||.1;switch(this.gravityDirection){case"up":this.Force.y+=-e;break;case"down":this.Force.y+=e;break;case"left":this.Force.x+=-e;break;case"right":this.Force.x+=e}}function J(){switch(this.gravityDirection){case"up":this.Force.y=3;break;case"down":this.Force.y=-3;break;case"left":this.Force.x=3;break;case"right":this.Force.x=-3}}function U(t,e){switch(this.setDirection(),this.color){case"red":case"falling":this.redMovement(t);break;case"blue":this.blueMovement(t,e)}this.slamming&&this.scene.matter.step(1),this.updateVelocity(),this.maxSpeed()}function q(){var t={up:!0,down:!0,left:!0,right:!0};"blue"===this.color&&(t[this.gravityDirection]=!1);var e={up:!1,down:!1,left:!1,right:!1};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&t[s]&&this.director.cursors["".concat(s,"IsDown")]&&(e[s]=!0);for(var s in t.down&&t.up&&e.down&&e.up&&(e.down=!1,e.up=!1),t.left&&t.right&&e.left&&e.right&&(e.left=!1,e.right=!1),e)if(Object.prototype.hasOwnProperty.call(e,s)&&e[s])return!0;return!1}function $(){this.colliding!==p.Label.platform&&((this.collidingAt.top||this.collidingAt.bottom)&&(this.Force.y=0),(this.collidingAt.left||this.collidingAt.right)&&(this.Force.x=0))}function Q(){var t=3;this.colliding==p.Label.platform&&(t=1.5),this.slamming||(this.Force.x>t?this.Force.x=t:this.Force.x<-t&&(this.Force.x=-t),this.Force.y>t?this.Force.y=t:this.Force.y<-t&&(this.Force.y=-t))}function tt(t){var e=w(t,{x:{type:"string",default:!1},y:{type:"string",default:!1}},this.director.AttackLoader.runAttackPos);e.x&&(this.director.GameMath.variables[e.x]=this.Image.x),e.y&&(this.director.GameMath.variables[e.y]=this.Image.y)}function et(t,e){switch(e){case"getPos":e="getPosition";break;case"setPos":e="setPosition";break;case"setG":e="setGravity"}O.call(this,t,e)}var st=function(){function t(t,e,s){this.scene=t,this.collide=e,this.director=s,this.canJump=!1,this.color="red",this.gravityDirection="down",this.slamming=!1,this.colliding=!1,this.Force={x:0,y:0},this.jumped=!1,this.Image=this.scene.matter.add.image(0,0,p.Image.heart),this.Image.setDepth(p.Depth.heart),this.Image.setFriction(0,0,0),this.Image.setMass(p.MASS),this.Image.setBounce(0),this.Image.setIgnoreGravity(!0),this.jumpTime=0,this.jumping=!1,this.moveWithPlatform=!1,this.normalSpeed=3,this.slowSpeed=1,this.collidingAt={top:!1,bottom:!1,left:!1,right:!1},this.blueMovement=F,this.redMovement=G,this.setGravity=V,this.setDirection=Y,this.touching=W,this.onGravity=Z,this.onJump=J,this.setCollisionGravity=$,this.maxSpeed=Q,this.getPosition=tt,this.router=et,this.update=U,this.Image.setCollisionCategory(e),this.Image.setOnCollideActive(this.touching.bind(this)),this.Image.setOnCollideEnd(this.notTouching.bind(this)),this.Image.body.label=p.Label.heart}return Object.defineProperty(t.prototype,"isFalling",{get:function(){return X.call(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"moving",{get:function(){return q.call(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ImageSize",{get:function(){var t=new Phaser.Geom.Rectangle;return t.width=this.Image.displayWidth,t.height=this.Image.displayHeight,t.centerX=this.Image.x,t.centerY=this.Image.y,t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Edge",{get:function(){return new Phaser.Math.Vector2(this.Image.x,this.Image.y+this.Image.displayHeight/2)},enumerable:!1,configurable:!0}),t.prototype.notTouching=function(){this.canJump=!1,this.colliding=!1,this.jumping||(this.jumpTime=0),this.collidingAt={top:!1,bottom:!1,left:!1,right:!1}},t.prototype.setColor=function(t){var e=w(t,{color:"string",playSound:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos);this.color=e.color,this.canJump=!1,e.playSound&&this.scene.sound.play(p.Audio.ding)},t.prototype.setPosition=function(t){var e=w(t,{x:{type:["number","boolean"],default:!1},y:{type:["number","boolean"],default:!1},duration:{type:["number","boolean"],default:!1}},this.director.AttackLoader.runAttackPos),s=e.x,i=e.y;"number"==typeof e.duration&&e.duration>0?!1!==s&&!1!==i?this.scene.tweens.add({targets:this.Image,props:{x:s,y:i},duration:e.duration}):(!1!==s&&this.scene.tweens.add({targets:this.Image,props:{x:s},duration:e.duration}),!1!==i&&this.scene.tweens.add({targets:this.Image,props:{x:i},duration:e.duration})):(!1!==s&&(this.Image.x=s),!1!==i&&(this.Image.y=i))},t.prototype.playerTurnInit=function(){this.setColor({color:"red"}),this.gravityDirection="down",this.Image.setTint(16711680),this.Force={x:0,y:0},this.Image.setVelocity(0),this.Image.setAngularVelocity(0),this.Image.isStatic()||this.Image.setStatic(!0)},t.prototype.enemyTurnInit=function(){this.setColor({color:"red"}),this.gravityDirection="down",this.Image.visible||this.Image.setVisible(!0),this.Image.setPosition(320,300),this.Image.isStatic()&&this.Image.setStatic(!1)},t.prototype.updateVelocity=function(){this.Image.setVelocity(this.Force.x,this.Force.y)},t}();const it=st,nt=function(){function t(t){var e;this.command=t,this.texts=["sans"];var s=this.command,i=this.command.director.CombatzoneDirector.midDialogPoint;e=[s.SCENE.add.sprite(i.x,i.y,p.Image.target).setDepth(s.depth).setVisible(!1),s.SCENE.add.sprite(30,i.y,p.Sheet.tagBar).setDepth(s.depth).setVisible(!1),s.SCENE.add.sprite(320,100,p.Sheet.attacked).setDepth(s.depth).setVisible(!1)],this.target=e[0],this.bar=e[1],this.slash=e[2],this.setActives(!1),s.SCENE.anims.create({key:p.Anim.barFlash,frames:p.Sheet.tagBar,duration:200,repeat:10,yoyo:!0}),s.SCENE.anims.create({key:p.Anim.attacking,frames:p.Sheet.attacked,duration:450,repeat:0,hideOnComplete:!0})}return t.prototype.startInit=function(){var t=this.command,e=t.textsPos[0].x+10,s=t.textsPos[0].y+16;t.diaTexts[0].setText("  * "+this.texts),t.Heart.Image.setPosition(e,s),this.target.setScale(.1,1)},t.prototype.setActives=function(t){for(var e=0,s=[this.target,this.bar,this.slash];e<s.length;e++)s[e].setActive(t);t&&(this.command.director.CombatzoneDirector.draws=this.command.director.CombatzoneDirector.draws.concat([this.target,this.bar]))},t.prototype.action=function(t){var e=this.command;e.resetTexts(e.diaTexts),e.resetButtons(),this.setActives(!0),this.slash.setVisible(!1),this.barTween=e.SCENE.tweens.add({targets:this.bar,delay:300,props:{x:{value:600,duration:1300}},onComplete:this.notAttacked,onCompleteScope:this}),e.SCENE.tweens.add({targets:this.target,delay:0,duration:300,scaleX:1}),e.Heart.Image.setVisible(!1),this.zEvent=t.once("down",this.attacked.bind(this))},t.prototype.getActions=function(){return this.texts},t.prototype.attacked=function(){var t=this,e=this.command;e.director.AttackLoader.attacked=!0,e.director.Sans.avoid().setCallback("onComplete",(function(){t.endInit(),t.command.SCENE.events.emit(p.Event.endTurn)}),[this],this).completeDelay=400,e.SCENE.sound.play(p.Audio.fight),this.barTween.stop(),this.bar.anims.play(p.Anim.barFlash),this.slash.setVisible(!0).anims.play(p.Anim.attacking),e.SCENE.tweens.add({targets:this.slash,delay:0,props:{y:{value:200,duration:400,yoyo:!0}}})},t.prototype.notAttacked=function(){var t=this;this.barTween.stop(),this.command.director.Sans.showDamage(),this.zEvent.off("down",void 0,void 0,!0),this.command.SCENE.time.delayedCall(1e3,(function(){t.command.SCENE.events.emit(p.Event.endTurn),t.endInit()}),void 0,this)},t.prototype.endInit=function(){var t=this.command.director.CombatzoneDirector.midDialogPoint;this.bar.setPosition(30,t.y).anims.stop(),this.setActives(!1)},t.prototype.update=function(){},t}(),ot=function(){function t(t){this.command=t,this.texts=[["sans",["check"],["SANS 1 ATK 1 DEF\n* The easiest enemy.\n* Can only deal 1 damage."]]],this.select=0,this.choices=[!1,!1,!1,!1],this.endAction=!1}return t.prototype.startInit=function(){var t=this.command,e=t.textsPos[0].x+10,s=t.textsPos[0].y+16;t.diaTexts[0].setText("  * "+this.texts[0][0]),t.Heart.Image.setPosition(e,s)},t.prototype.getActions=function(){return this.texts},t.prototype.action=function(){for(var t=this.command,e=0;e<this.texts[0][1].length;e++)t.diaTexts[e].setText("  * "+this.texts[0][1][e]),this.choices[e]=!0},t.prototype.setHeartPos=function(){var t=this.command,e=t.textsPos[this.select].x+10,s=t.textsPos[this.select].y+16;t.Heart.Image.setPosition(e,s)},t.prototype.selectAct=function(t){var e=!1;switch(t){case"left":case"right":if(this.select%2==0){this.choices[this.select+1]&&(this.select++,e=!0);break}if(this.select%2==1){this.choices[this.select-1]&&(this.select--,e=!0);break}break;case"up":case"down":if(e=!0,this.select<=1){this.choices[this.select+2]&&(this.select+=2);break}if(this.select>=2){this.choices[this.select-2]&&(this.select-=2);break}}e||(this.select=0),this.setHeartPos()},t.prototype.endInit=function(){this.command.SCENE.events.emit(p.Event.endTurn),this.textId.remove(),this.endAction=!1},t.prototype.zKeyEvent=function(t){t.once("down",this.endInit.bind(this))},t.prototype.update=function(t,e,s){if(!this.endAction){var i=this.command,n=Phaser.Input.Keyboard.JustDown;t.leftIsJustDown&&this.selectAct("left"),t.rightIsJustDown&&this.selectAct("right"),t.upIsJustDown&&this.selectAct("up"),t.downIsJustDown&&this.selectAct("down"),n(e)?(i.endingTurn=!1,i.actionInit()):n(s)&&(i.SCENE.sound.play(p.Audio.select),i.resetTexts(i.diaTexts),this.textId=i.rollDiaText(i.diaTexts[0],"* "+this.texts[0][2][this.select]),i.Heart.Image.setVisible(!1),i.resetButtons(),this.endAction=!0,i.SCENE.events.once(p.Event.endRoll,this.zKeyEvent.bind(this,s)))}},t}(),at=function(){function t(t,e){this.command=t,this.texts=["pie","noodle","steak","snowPiece","snowPiece","snowPiece","lHero","lHero"],this.page=0,this.select=0,this.choices=[!1,!1,!1,!1],e&&(this.texts=e)}return t.prototype.startInit=function(){var t=this.command,e=t.textsPos[0].x+10,s=t.textsPos[0].y+16;t.Heart.Image.setPosition(e,s),t.Heart.Image.setAngle(0);var i=this.texts.length;i=i<=4?i:4;for(var n=0;n<i;n++){var o=this.texts[n];t.diaTexts[n].setText("  * "+p.Item[o].name)}},t.prototype.getActions=function(){return this.texts.slice(4*this.page,4*this.page+4)},t.prototype.flip=function(){if(!(this.texts.length<=4)){var t=this.command;switch(this.page){case 0:this.page++;break;case 1:this.page--}var e=this.texts;t.resetTexts(t.diaTexts);for(var s=4*this.page;s<4+4*this.page;s++){var i=e[s];if(void 0===i)break;t.diaTexts[s%4].setText("  * "+p.Item[i].name)}}},t.prototype.action=function(t){var e=this.command,s=this.texts[e.selectAct+4*this.page];e.SCENE.config.settings&&e.SCENE.config.settings.infItem||this.texts.splice(e.selectAct+4*this.page,1),e.resetButtons(),this.page=0,this.showSummery(p.Item[s],t)},t.prototype.zKeyEvent=function(t){t.once("down",this.endInit.bind(this))},t.prototype.showSummery=function(t,e){var s=this.command,i=s.Statuses.healHp(t);s.resetTexts(s.diaTexts),this.textId=s.rollDiaText(s.diaTexts[0],"* You eat the ".concat(t.displayName,".\n* You recovered ").concat(t.amount,"HP.").concat(i?"\n* Your hp was maxed out!":"")),s.Heart.Image.setVisible(!1),t.description?s.SCENE.events.once(p.Event.endRoll,this.showDetails.bind(this,t.description,e)):s.SCENE.events.once(p.Event.endRoll,this.zKeyEvent.bind(this,e))},t.prototype.showDetails=function(t,e){var s=this;e.once("down",(function(){var i=s.command;i.diaTexts[0].setText(""),s.textId=i.rollDiaText(i.diaTexts[0],t),i.SCENE.events.once(p.Event.endRoll,s.zKeyEvent.bind(s,e))}),this)},t.prototype.endInit=function(){this.command.SCENE.events.emit(p.Event.endTurn),this.textId.remove()},t.prototype.update=function(){},t}(),rt=function(){function t(t){this.command=t,this.texts=["spare"]}return t.prototype.startInit=function(){var t=this.command,e=t.textsPos[0].x+10,s=t.textsPos[0].y+16;t.diaTexts[0].setText("  * "+this.texts),t.Heart.Image.setPosition(e,s)},t.prototype.getActions=function(){return this.texts},t.prototype.action=function(){this.command.SCENE.events.emit(p.Event.endTurn),this.command.resetButtons()},t.prototype.update=function(){},t}();function ht(t,e,s){var i=this.getCommands();if(this.endingTurn&&void 0!==i.update)i.update(t,e,s);else{var n=Phaser.Input.Keyboard.JustDown;switch(this.commandType){case 0:if(t.leftIsJustDown&&this.keyTouch("left"),t.rightIsJustDown&&this.keyTouch("right"),this.updateCommand(),n(s))this.textId.remove(),this.commandType=1,this.actionInit();else if(e.ctrlKey){this.SCENE.events.off(p.Event.endTurn),this.SCENE.sound.stopByKey(p.Audio.BGM),this.SCENE.scene.start(p.Scene.mainMenu,this.SCENE.config);break}break;case 1:var o=this.updateMenu.bind(this);t.leftIsJustDown&&o("left"),t.rightIsJustDown&&o("right"),t.upIsJustDown&&o("up"),t.downIsJustDown&&o("down"),n(e)?(this.commandType=0,this.resetTexts(this.diaTexts),this.dialogText(),this.SCENE.sound.play(p.Audio.select)):n(s)&&(this.SCENE.sound.play(p.Audio.select),this.endingTurn=!0,i.action(s))}}}function ct(t){var e=!1;if(2===this.selectedCommand&&this.Item.texts.length>3)switch(t){case"left":this.selectAct%2==0&&this.Item.flip();break;case"right":this.selectAct%2==1&&this.Item.flip()}switch(this.howManyActions(),t){case"left":case"right":if(this.selectAct%2==0){this.pageAction[this.selectAct+1]&&(this.selectAct++,e=!0);break}if(this.selectAct%2==1){this.pageAction[this.selectAct-1]&&(this.selectAct--,e=!0);break}break;case"up":case"down":if(this.selectAct<=1){this.pageAction[this.selectAct+2]&&(this.selectAct+=2,e=!0);break}if(this.selectAct>=2){this.pageAction[this.selectAct-2]&&(this.selectAct-=2,e=!0);break}}e?this.SCENE.sound.play(p.Audio.cursor):this.selectAct=0}var lt=function(){function t(t,e,s,i,n){this.SCENE=t,this.director=e,this.depth=p.Depth.command,this.buttonPos=[];var o=[p.Sheet.fight,p.Sheet.act,p.Sheet.item,p.Sheet.mercy];this.buttons=[],this.diaTexts=[],this.selectAct=0,this.selectedCommand=0,this.commandType=0,this.pageAction=[!0,!0,!0,!0],this.endingTurn=!1,this.Fight=new nt(this),this.Act=new ot(this),this.Item=new at(this),this.Mercy=new rt(this),this.Heart=s,this.Combatzone=i,this.Statuses=n;for(var a=0;a<o.length;a++)this.buttonPos[a]={x:85+155*a,y:450,Image:o[a]};var r=this.buttonPos;for(a=0;a<r.length;a++){var h=r[a];this.buttons[a]=t.add.sprite(h.x,h.y,h.Image,0).setDepth(this.depth)}var c={fontFamily:"battlefont",fontSize:"128px",maxLines:3,padding:{bottom:300}};this.textsPos=[{x:0,y:0}],this.diaTexts=[];var l=this.director.CombatzoneDirector.menuRect.x+10,d=this.director.CombatzoneDirector.menuRect.y+10;for(a=0;a<4;a++){var u={x:l+a%2*250,y:d+50*Math.floor(a/2)};this.textsPos[a]={x:u.x,y:u.y},this.diaTexts[a]=t.add.text(u.x,u.y,"",c).setScale(.25).setDepth(this.depth)}this.diaTexts.forEach((function(t){t.setVisible(!1)})),this.setTextsActive(!1),this.update=ht,this.selectAction=ct}return t.prototype.setTextsActive=function(t){this.resetTexts(this.diaTexts);for(var e=0,s=this.diaTexts;e<s.length;e++){var i=s[e];i.scene&&i.setActive(t)}t&&(this.director.CombatzoneDirector.draws=this.director.CombatzoneDirector.draws.concat(this.diaTexts))},t.prototype.rollDiaText=function(t,e){var s=this,i=e.length,n=0;return this.SCENE.time.addEvent({callback:function(){t.setText(t.text+[e[n]]),s.SCENE.sound.play(p.Audio.battleText),n>=i-1&&s.SCENE.events.emit(p.Event.endRoll),++n},repeat:i-1,delay:25})},t.prototype.updateCommand=function(){for(var t=0,e=this.buttons;t<e.length;t++)e[t].setFrame(0);var s=this.buttonPos;this.Heart.Image.setPosition(s[this.selectedCommand].x-40,s[this.selectedCommand].y),this.Heart.Image.setAngle(0),this.buttons[this.selectedCommand].setFrame(1)},t.prototype.keyTouch=function(t){switch(t){case"left":if(this.selectedCommand<=0){this.selectedCommand=this.buttonPos.length-1;break}this.selectedCommand--;break;case"right":if(this.selectedCommand>=this.buttonPos.length-1){this.selectedCommand=0;break}this.selectedCommand++}this.SCENE.sound.play(p.Audio.cursor)},t.prototype.getCommands=function(){switch(this.selectedCommand){case 0:return this.Fight;case 1:return this.Act;case 2:return this.Item;case 3:return this.Mercy;default:console.error(this.selectedCommand,"error in getCommands")}return this.Fight},t.prototype.howManyActions=function(){for(var t=[],e=0,s=this.getCommands().getActions();e<s.length;e++){var i=s[e];t.push(Boolean(i))}this.pageAction=t},t.prototype.updateMenu=function(t){this.selectAction(t);var e=this.textsPos[this.selectAct].x+10,s=this.textsPos[this.selectAct].y+16;this.Heart.Image.setPosition(e,s)},t.prototype.actionInit=function(){this.SCENE.sound.play(p.Audio.select),this.selectAct=0,this.getCommands().startInit()},t.prototype.resetTexts=function(t){for(var e=0,s=t;e<s.length;e++){var i=s[e];i.scene&&i.setText("")}},t.prototype.resetButtons=function(){for(var t=0,e=this.buttons;t<e.length;t++)e[t].setFrame(0)},t.prototype.dialogText=function(){this.director.AttackLoader.resting?this.textId=this.rollDiaText(this.diaTexts[0],p.Text.resting):this.textId=this.rollDiaText(this.diaTexts[0],p.Text.batTime)},t.prototype.playerTurnInit=function(){this.setTextsActive(!0),this.updateCommand(),this.dialogText(),this.SCENE.events.once(p.Event.endTurn,this.director.AttackLoader.endPlayerTurn.bind(this.director.AttackLoader))},t.prototype.endPlayerTurn=function(){this.commandType=0,this.setTextsActive(!1),this.endingTurn=!1},t}();const dt=lt;function ut(){this.hp<=1?this.kr=0:(this.kr>=this.hp&&(this.kr=this.hp-1),this.kr>0&&(this.kr--,this.hp--,this.hpText.setText("".concat(this.hp," / ").concat(this.maxHp)).setTint(16711935))),this.setDisplay(),this.setBars();var t=this.kr>30?200:this.kr>20?400:this.kr>10?600:800;this.scene.time.delayedCall(t,this.krDecrease,void 0,this)}function pt(){this.HpBar.setScale((this.hp-this.kr)/this.barSize,1.3),this.KrBar.setScale(this.kr/this.barSize,1.3),this.KrBar.setPosition(this.HpBar.x+this.HpBar.displayWidth/2+this.KrBar.displayWidth/2,0),this.HpBar.setPosition(this.HpBackGround.x-this.HpBackGround.displayWidth/2+this.HpBar.displayWidth/2,0)}function gt(t){var e=t.amount||this.maxHp/2;return this.hp+=e,this.scene.sound.play(p.Audio.heal),t.debug&&(this.kr=0),this.hp>this.maxHp?(this.scene.config.settings&&this.scene.config.settings.ignoreKr&&(this.kr-=this.hp-this.maxHp,this.kr<0&&(this.kr=0)),this.hp=this.maxHp,this.hpText.setText("".concat(this.hp," / ").concat(this.maxHp)),!0):(this.hpText.setText("".concat(this.hp," / ").concat(this.maxHp)),!1)}function yt(t){t.easyMode?(this.takeDamageSpeed=4,this.takeKr=2,this.HpBar.setTint(65280)):(this.takeDamageSpeed=2,this.takeKr=4),t.infHP?this.noTakeDamage=!0:this.noTakeDamage=!1,t.phase2&&(this.director.AttackLoader.phase=2)}var ft=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const mt=function(t){function e(e,s,i){var n=t.call(this,e,320,i)||this;return n.director=s,n.hp=92,n.kr=0,n.maxHp=92,n.barSize=15,n.takeDamageSpeed=2,n.noTakeDamage=!1,n.takeKr=4,n.damageCounter=0,n.takenDamage=!1,n.HpBar=n.scene.add.image(0,0,p.Image.block),n.HpBar.setTint(16776960),n.KrBar=n.scene.add.image(0,0,p.Image.block),n.KrBar.setTint(16711935),n.HpBackGround=n.scene.add.image(-15,0,p.Image.block),n.HpBackGround.setTint(16711680),n.HpBackGround.setScale(n.maxHp/n.barSize,1.3),n.HP=e.add.image(-90,0,p.Image.HPfont),n.KR=e.add.image(60,0,p.Image.KRfont),n.playerText=n.scene.add.text(-213,0,"CHARA   LV19",{fontFamily:"gameHUB",fontSize:"128px"}).setScale(.18).setOrigin(.5,.5),n.hpText=n.scene.add.text(140,0,"".concat(n.hp," / ").concat(n.maxHp),{fontFamily:"gameHUB",fontSize:"128px"}).setScale(.18).setOrigin(.5,.5),n.add([n.hpText,n.playerText,n.HpBackGround,n.HpBar,n.KrBar,n.HP,n.KR]),e.add.existing(n),n.setDepth(p.Depth.statuses),n.krDecrease=ut,n.setBars=pt,n.healHp=gt,n.setSetting=yt,e.time.delayedCall(400,n.krDecrease,void 0,n),n}return ft(e,t),e.prototype.setDisplay=function(){this.hp<=this.kr&&(this.kr=this.hp-1),this.hpText.setText("".concat(this.hp," / ").concat(this.maxHp)),this.kr>0?this.hpText.setTint(16711935):this.hpText.setTint(16777215)},e.prototype.takeDamage=function(t){!0!==this.director.Heart.Image.visible||this.takenDamage||(this.takenDamage=!0,this.damageCounter===this.takeDamageSpeed?(this.damageCounter=0,this.hp-this.kr<=this.takeKr?(this.hp--,this.kr=this.hp-1,this.scene.sound.play(p.Audio.damage),this.hpText.setText("".concat(this.hp," / ").concat(this.maxHp)).setTint(16711935)):(this.hp--,(t||null==t)&&(this.scene.config.settings&&this.scene.config.settings.noKr||(this.kr+=this.takeKr)),this.setDisplay(),this.scene.sound.play(p.Audio.damage))):this.damageCounter++)},e.prototype.update=function(t){if(this.setBars(),this.hp-this.kr<60&&this.scene.config.settings&&this.scene.config.settings.practice&&(this.hp=this.maxHp,this.kr=0,this.setDisplay(),this.director.AttackLoader.retry()),this.hp<=0&&this.kr<=0){this.scene.sound.stopByKey(p.Audio.BGM);var e=this.director.Heart.Image.x,s=this.director.Heart.Image.y;this.scene.scene.start(p.Scene.gameOver,{x:e,y:s,attack:this.scene.config})}this.noTakeDamage&&(this.hp=this.maxHp,this.kr=0,this.setDisplay()),this.takenDamage?this.takenDamage=!1:this.damageCounter=this.takeDamageSpeed},e}(Phaser.GameObjects.Container);function bt(t){var e=this,s=w(t,{target:{type:"string",default:"head"},frame:{type:["string","boolean"],default:!1},autoInit:{type:"boolean",default:!1},state:{type:["string","boolean"],default:!1},anim:{type:["string","boolean"],default:!1},visible:{type:"boolean",default:!0}},this.director.AttackLoader.runAttackPos),i=this[s.target];if(i.setVisible(s.visible),s.anim&&"torso"===s.target){switch(s.anim){case"upSlam":this.torso.anims.playReverse(p.Anim.downSlam);break;case"downSlam":this.torso.anims.play(p.Anim.downSlam);break;case"leftSlam":this.torso.anims.play(p.Anim.leftSlam);break;case"rightSlam":this.torso.anims.playReverse(p.Anim.leftSlam);break;default:console.warn("anim name is not defined at ".concat(this.director.AttackLoader.runAttackPos," turn with ").concat(s.anim))}this.slamming=!0,s.autoInit||"leftSlam"===s.anim?(this.torso.off("animationcomplete"),this.torso.once("animationcomplete",(function(){e.torso.setFrame("torso"),e.slamming=!1,e.head.setPosition(0,e.headY),e.torso.setPosition(0,0)}),this)):(this.torso.off("animationcomplete"),this.torso.once("animationcomplete",(function(){e.slamming=!1}),this))}else if(s.anim&&"head"===s.target)"flashEye"===s.anim?this.head.anims.play(p.Anim.flashEyes):console.warn("anim error on ".concat(this.director.AttackLoader.runAttackPos," turn with ").concat(s.anim));else if("sweet"===s.target&&"addSweet"===s.frame)if(i.visible){var n=Number.parseInt(i.frame.name.slice(-1));n<=2&&n++,i.setFrame("sweet".concat(n))}else i.setVisible(!0);else s.frame&&(i.anims.stop(),i.setFrame(s.frame));s.state&&(this.state=s.state)}function vt(t){if(this.yAuto&&this.setPosition(this.x,this.director.CombatzoneDirector.Zones.main.RectSize.y-(this.leg.y+this.leg.height/2)-20),this.slamming)switch(this.torso.frame.name){case"torsoside1":this.head.setPosition(4,this.headY),this.torso.setPosition(4,0);break;case"torsoside2":this.head.setPosition(-4,this.headY),this.torso.setPosition(-4,0);break;case"torsoupside1":this.head.setPosition(0,this.headY-2),this.torso.setPosition(0,-2);break;case"torsoupside3":this.head.setPosition(0,this.headY+2),this.torso.setPosition(0,2);break;default:this.head.setPosition(0,this.headY),this.torso.setPosition(0,0)}else switch(this.state){case"dancing":this.head.setPosition(Math.sin(this.animX),Math.sin(this.animY)+this.headY+.5*Math.cos(t/this.animSpeed*2%Math.PI*2-Math.PI)),this.animX=t/this.animSpeed%Math.PI*2-Math.PI,this.animY=t/(this.animSpeed/2)%Math.PI*2-Math.PI,this.torso.setPosition(Math.sin(this.animX),1.3*Math.sin(this.animY));break;case"tired":this.head.setPosition(0,this.torso.y+this.headY),this.animY=t/(3.75*this.animSpeed)%Math.PI*2-Math.PI,this.torso.setPosition(0,1.3*Math.sin(this.animY))}if(this.falling){var e=!1;switch(this.falling){case"down":this.y<0&&(this.y=this.scene.game.scale.height,e=!0),this.y-=10;break;case"up":this.y>this.scene.game.scale.height&&(this.y=0,e=!0),this.y+=10;break;case"right":this.x<0&&(this.x=this.scene.game.scale.width,e=!0),this.x-=10;break;case"left":this.x>this.scene.game.scale.width&&(this.x=0,e=!0),this.x+=10}if(e){var s=this.head.texture.getFrameNames();s.forEach((function(t,e,i){"blueeye"===t&&s.splice(e,1)})),s.forEach((function(t,e,i){"yelloweye"===t&&s.splice(e,1)})),this.head.setFrame(s[Phaser.Math.Between(0,s.length-1)])}}this.sweet.setPosition(this.head.x,this.head.y-20)}function xt(t){var e=w(t,{x:{type:["number","boolean"],default:!1},y:{type:["number","string","boolean"],default:!1},ease:{type:"string",default:"Linear"},duration:{type:["number","boolean"],default:!1}},this.director.AttackLoader.runAttackPos);e.duration?"number"==typeof e.x&&"number"==typeof e.y?(this.yAuto=!1,this.scene.tweens.add({targets:this,props:{x:e.x,y:e.y},duration:e.duration,ease:e.ease})):("number"==typeof e.x&&this.scene.tweens.add({targets:this,props:{x:e.x},duration:e.duration,ease:e.ease}),!1!==e.y&&("auto"===e.y?this.yAuto=!0:"lock"===e.y?this.yAuto=!1:(this.yAuto=!1,this.scene.tweens.add({targets:this,props:{y:e.y},duration:e.duration,ease:e.ease})))):(!1!==e.x&&(this.x=e.x),!1!==e.y&&("auto"===e.y?this.yAuto=!0:"lock"===e.y?this.yAuto=!1:(this.yAuto=!1,this.y=e.y)))}var wt=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),At=function(t){function e(e,s,i,n){var o=t.call(this,e,s,i)||this;return o.torsoX=0,o.torsoY=0,o.legY=47,o.headY=-43,o.animX=0,o.animY=0,o.animSpeed=400,o.avoidWait=1200,o.avoidSpeed=400,o.slamming=!1,o.yAuto=!0,o.state="dancing",o.director=n,o.leg=e.add.sprite(0,o.legY,p.Sheet.sansLeg).setScale(2),o.torso=e.add.sprite(o.torsoX,o.torsoY,p.Sheet.sansTorso).setScale(2),o.head=e.add.sprite(0,o.headY,p.Sheet.sansHead).setScale(2),o.sweet=e.add.sprite(0,o.headY-20,p.Sheet.sansSweet).setScale(2).setVisible(!1),o.add([o.leg,o.torso,o.head,o.sweet]),e.add.existing(o),o.damageText=o.scene.add.text(320,i-90,"miss",{fontFamily:"damagefont",fontSize:"100px",color:"#999"}).setScale(.25).setVisible(!1).setOrigin(.5).setDepth(p.Depth.sans),o.setDepth(p.Depth.sans),o.setPos=xt,function(t){t.anims.create({key:p.Anim.downSlam,frames:[{key:p.Sheet.sansTorso,frame:"torsoupside1",duration:75},{key:p.Sheet.sansTorso,frame:"torsoupside2",duration:75},{key:p.Sheet.sansTorso,frame:"torsoupside3",duration:75}]}),t.anims.create({key:p.Anim.leftSlam,frames:[{key:p.Sheet.sansTorso,frame:"torsoside1",duration:75},{key:p.Sheet.sansTorso,frame:"torsoside2",duration:75}]}),t.anims.create({key:p.Anim.flashEyes,frames:[{key:p.Sheet.sansHead,frame:"blueeye",duration:50},{key:p.Sheet.sansHead,frame:"yelloweye",duration:50}],repeat:-1})}(e),o.setVisual=bt,o.update=vt,o}return wt(e,t),e.prototype.avoid=function(){return this.scene.tweens.add({targets:this,delay:0,props:{x:{value:this.x-100,duration:this.avoidSpeed,yoyo:!0,hold:this.avoidWait}},hold:this.avoidWait,duration:this.avoidSpeed,ease:"Sine.easeOut",onStart:this.showDamage,onStartScope:this})},e.prototype.showDamage=function(){var t=this;this.scene.time.addEvent({delay:this.avoidSpeed,repeat:0,callback:function(){t.damageText.setVisible(!0),t.damageText.setActive(!0)},callbackScope:this}),this.scene.time.addEvent({delay:this.avoidSpeed+this.avoidWait,repeat:0,callback:function(){t.damageText.setVisible(!1),t.damageText.setActive(!1)},callbackScope:this})},e.prototype.router=function(t,e){"setPosition"===e&&(e="setPos"),O.call(this,t,e)},e}(Phaser.GameObjects.Container);const kt=At;function Pt(){if(this.oldLength!==this.displayLength){var t=this.top.displayHeight+this.bottom.displayHeight;Math.abs(this.displayLength)<=Math.abs(t)?this.boneLength=1:this.boneLength=this.displayLength-t;var e=this.angle;this.setAngle(0),this.middle.displayHeight=this.boneLength,this.top.setPosition(0,-this.middle.displayHeight/2-this.top.displayHeight/2),this.bottom.setPosition(0,this.middle.displayHeight/2+this.bottom.displayHeight/2);var s=this.body,i=this.scene.matter.bodyBounds.getTopCenter(s),n=this.scene.matter.bodyBounds.getBottomCenter(s);if(i&&n){var o=i.y-n.y;this.scene.matter.body.scale(s,1,this.boneLength/o)}if("middle"!==this.tweenAnchor){var a=this.displayLength-this.oldLength,r=new Phaser.Math.Vector2(0,a/2);"top"===this.tweenAnchor?(r.rotate(Phaser.Math.DegToRad(e+180)),this.x+=r.x,this.y+=r.y):(r.rotate(Phaser.Math.DegToRad(e)),this.x+=r.x,this.y+=r.y)}this.setAngle(e)}}function St(){if(this.angle!==this.oldAngle&&"middle"!==this.tweenAnchor){var t=new Phaser.Math.Vector2(this.x,this.y),e=new Phaser.Math.Vector2(this.x,this.y+this.displayLength/2);"top"===this.tweenAnchor?(Phaser.Math.RotateAround(e,this.x,this.y,Phaser.Math.DegToRad(this.oldAngle+180)),Phaser.Math.RotateAround(t,e.x,e.y,Phaser.Math.DegToRad(this.angle-this.oldAngle)),this.setPosition(t.x,t.y)):(Phaser.Math.RotateAround(e,this.x,this.y,Phaser.Math.DegToRad(this.oldAngle)),Phaser.Math.RotateAround(t,e.x,e.y,Phaser.Math.DegToRad(this.angle-this.oldAngle)),this.setPosition(t.x,t.y))}}function Tt(){if(this.body){if(this.speed)if(this.speedAngle){var t=new Phaser.Math.Vector2(this.speed,0);t.rotate(Phaser.Math.DegToRad(this.speedAngle)),this.x+=t.x,this.y+=t.y}else this.x+=this.speed;this.setAngle(this.angle+this.spin),Pt.call(this),St.call(this),this.oldColor!==this.color&&this.setColor(p.Color[this.colorKey]),this.oldColor=this.color,this.oldLength=this.displayLength,this.oldAngle=this.angle}else this.scene.tweens.killTweensOf(this)}function Dt(){this.scene&&(this.removeAll(!0),this.destroy())}function Ct(t){if(this.scene)if(t){switch(t.tween){case"smallerMiddle":case"smallerTop":case"smallerBottom":"smallerTop"===t.tween?this.tweenAnchor="top":"smallerBottom"===t.tween&&(this.tweenAnchor="bottom"),this.state="dying",this.scene.tweens.add({targets:this,props:{displayLength:this.top.displayHeight+this.bottom.displayHeight},duration:t.duration||1e3,onComplete:Dt,onCompleteScope:this})}"disappear"===t.effect&&(this.state="dying",this.scene.tweens.add({targets:this,props:{alpha:0},duration:t.duration||1e3,onComplete:Dt,onCompleteScope:this})),t.effect||t.tween||Dt.call(this)}else Dt.call(this)}function It(t){var e=this;if(this.scene)if(t){switch(t.tween){case"biggerMiddle":case"biggerTop":case"biggerBottom":"biggerTop"===t.tween?this.tweenAnchor="top":"biggerBottom"===t.tween&&(this.tweenAnchor="bottom");var s=this.tweenAnchor,i=this.displayLength;i>this.top.displayHeight+this.bottom.displayHeight+1?(this.displayLength=this.top.displayHeight+this.bottom.displayHeight,this.scene.tweens.add({targets:this,props:{displayLength:i},duration:t.duration||1e3,onComplete:function(){e.state="living",e.tweenAnchor=s},onCompleteScope:this})):this.state="living"}"appear"===t.effect&&(this.setAlpha(0),this.scene.tweens.add({targets:this,props:{alpha:1},duration:t.duration||1e3,onComplete:function(){e.state="living"},onCompleteScope:this})),t.effect||t.tween||(this.state="living")}else this.state="living"}function Ot(t,e){var s;"number"!=typeof(s=e?T(t):t).angle&&(s.angle=0),s.anchor||(s.anchor={}),s.anchor.x||(s.anchor.x="bottom"),s.anchor.y||(s.anchor.y="bottom");var i={x:{top:-s.width/2,middle:0,bottom:s.width/2},y:{top:-s.height/2,middle:0,bottom:s.height/2}};s.origin&&(s.origin.width&&(i.x.top=s.width/2-s.origin.width,i.x.middle=i.x.top+s.origin.width/2),s.origin.height&&(i.y.top=s.height/2-s.origin.height,i.y.middle=i.y.top+s.origin.height/2));var n=0;if("string"==typeof s.anchor.x)switch(s.anchor.x){case"middle":n=s.x+i.x.middle;break;case"bottom":n=s.x+i.x.bottom;break;case"top":n=s.x+i.x.top}else n=s.x+s.anchor.x+i.x.middle;var o=0;if("string"==typeof s.anchor.y)switch(s.anchor.y){case"middle":o=s.y+i.y.middle;break;case"bottom":o=s.y+i.y.bottom;break;case"top":o=s.y+i.y.top}else o=s.y+s.anchor.y+i.y.middle;var a=new Phaser.Math.Vector2(n,o);return s.angle%360!=0&&(a=Phaser.Math.RotateAround(a,s.x,s.y,Phaser.Math.DegToRad(s.angle))),s.x=a.x,s.y=a.y,s}function Rt(t,e,s){if(!s||this.director.Statuses.hp>1)switch(Math.floor(this.color)%3){case 0:this.scene.matter.overlap(this.director.Heart.Image.body,[t],this.director.Statuses.takeDamage.bind(this.director.Statuses,e));break;case 1:this.director.Heart.moving&&this.scene.matter.overlap(this.director.Heart.Image.body,[t],this.director.Statuses.takeDamage.bind(this.director.Statuses,e));break;case 2:this.director.Heart.moving||this.scene.matter.overlap(this.director.Heart.Image.body,[t],this.director.Statuses.takeDamage.bind(this.director.Statuses,e))}}function Mt(){switch(Math.floor(this.color)%3){case 0:default:return"white";case 1:return"blue";case 2:return"orange"}}function jt(t,e){if("string"==typeof t)switch(t){case"white":this.color=0,e&&this.setColor(p.Color.white);break;case"blue":this.color=1,e&&this.setColor(p.Color.blue);break;case"orange":this.color=2,e&&this.setColor(p.Color.orange)}else switch(this.color=Math.floor(t)%3,Math.floor(this.color)%3){case 0:e&&this.setColor(p.Color.white);break;case 1:e&&this.setColor(p.Color.blue);break;case 2:e&&this.setColor(p.Color.orange)}}function Lt(t){for(var e=0,s=this.tints;e<s.length;e++){var i=s[e];i&&i.setTint&&i.setTint(t)}}var Bt=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const _t=function(t){function e(e,s,i,n,o,a){var r=t.call(this,e,n,o,a)||this;return r.setColor=Lt,r.color=0,r.tints=[],r.colorKey=i||"white",r.director=s,r.checkTakeDamage=Rt,r}return Bt(e,t),Object.defineProperty(e.prototype,"colorKey",{get:function(){return Mt.call(this)},set:function(t){jt.call(this,t,this.tints)},enumerable:!1,configurable:!0}),e.prototype.update=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.checkTakeDamage(this.body)},e}(Phaser.GameObjects.Container);var Et=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),Kt=function(t){function e(e,s,i,n,o,a){var r=this,h=w(s,{x:{type:"number",default:0},y:{type:"number",default:0},speed:{type:"number",default:0},speedAngle:{type:"number",default:0},angle:{type:"number",default:0},spin:{type:"number",default:0},visible:{type:"boolean",default:!1},length:{type:"number",default:12},spawnTween:{type:["boolean","object"],default:!1},deleteTween:{type:["boolean","object"],default:!1},sound:{type:["string","boolean"],default:!1},color:{type:["string","number"],default:0},tweenAnchor:{type:"string",default:"middle"},tween:{type:["object","boolean"],default:!1},anchor:{type:"object",default:{x:"bottom",y:"bottom"}},lifetime:{type:["number","boolean"],default:!1}},n.AttackLoader.runAttackPos,a);(r=t.call(this,e,n,s.color)||this).spin=h.spin,r.speed=h.speed,r.speedAngle=h.speedAngle,r.moveType=o||"normal",r.deleteTweenType=h.deleteTween,r.spawnTweenType=h.spawnTween,r.state="appear",r.tweenAnchor=h.tweenAnchor,r.collision=i,r.deleteTween=Ct,r.spawnTween=It,r.middle=e.add.sprite(0,0,p.Image.bone,1),r.top=e.add.image(0,0,p.Image.bone,0),r.bottom=e.add.image(0,0,p.Image.bone,3);var c=r.top.displayHeight+r.bottom.displayHeight;r.displayLength=s.length||c,r.oldLength=r.displayLength,Math.abs(r.displayLength)<=Math.abs(c)?(r.boneLength=1,r.displayLength=c):r.boneLength=r.displayLength-c,r.middle.displayHeight=r.boneLength,r.top.setPosition(0,-r.middle.displayHeight/2-r.top.displayHeight/2),r.bottom.setPosition(0,r.middle.displayHeight/2+r.bottom.displayHeight/2),r.add([r.top,r.middle,r.bottom]);var l=r.middle.displayWidth,d=Ot({x:h.x,y:h.y,width:l,height:r.displayLength,anchor:h.anchor,angle:h.angle},!0);return r.setPosition(d.x,d.y),r.spawnTween(r.spawnTweenType),e.add.existing(r),r.setSize(.2*l,r.boneLength),r.MatterObject=e.matter.add.gameObject(r),r.MatterObject.setCollisionCategory(i),r.MatterObject.setCollidesWith(0),r.MatterObject.setFrictionAir(0),r.MatterObject.setMass(p.MASS),r.MatterObject.setIgnoreGravity(!0),r.setAngle(h.angle),h.sound&&r.scene.sound.play(p.Audio[h.sound]),r.tints=[r.top,r.middle,r.bottom],r.colorKey=s.color||"white",r.oldAngle=r.angle,r.oldColor=r.color,h.lifetime&&h.lifetime!==1/0&&r.scene.time.delayedCall(h.lifetime,r.deleteTween,[r.deleteTweenType],r),h.visible||("appear"!==r.state&&(r.director.CombatzoneDirector.draws.push(r),r.onRender=!0),r.visible=!1),r.onRender=!1,r.destroyed=!1,h.tween&&r.body&&C(e,r,h.tween,{length:"displayLength"}),r}return Et(e,t),e.prototype.update=function(){Tt.call(this),"menu"===this.moveType?this.checkTakeDamage(this.body,!1,!0):t.prototype.update.call(this)},e.prototype.destroy=function(e){this.scene&&this.scene.sys&&this.scene.sys.displayList&&(this.scene.tweens.killTweensOf(this),t.prototype.destroy.call(this,!1)),this.destroyed=!0},e}(_t);const Ht=Kt;function zt(t,e,s){switch((s%=360)<0&&(s+=360),s){case 0:return t.x<=e.x;case 90:return t.y>=e.y;case 180:return t.x>=e.x;case 270:return t.y<=e.y}return s<90?t.x<=e.x&&t.y>=e.y:s<180?t.x<=e.x&&t.y<=e.y:s<270?t.x>=e.x&&t.y<=e.y:t.x>=e.x&&t.y>=e.y}function Ft(){if(this.scene){this.scene.sound.play(p.Audio.boneStab),this.warnBox.clear(),this.warnBox.setActive(!1),this.state="stabbing";var t={x:0,y:0,length:this.length,lifetime:this.lifetime,spawnTween:{tween:"biggerBottom",duration:65},deleteTween:{tween:"smallerBottom",duration:65},color:this.color},e=new Phaser.Math.Vector2(11,0),s=this.Zone.up.angle,i=this.Zone.up.rotation,n=this.Zone.RectSize;switch(this.direction){case"up":var o=this.addTo.getBottomLeft(),a=this.addTo.getBottomRight();t.angle=s,e.rotate(i),o.subtract(e),a.add(e);do{t.x=o.x,t.y=o.y,this.Bones.push(this.BONE_DIRECTOR.addSingle(t)),o.add(e)}while(zt(o,a,s));break;case"right":var r=this.addTo.getBottomLeft(),h=this.addTo.getTopLeft();t.angle=s+90,e.rotate(Phaser.Math.DegToRad(s-90)),r.subtract(e),h.add(e);do{t.x=r.x,t.y=r.y,this.Bones.push(this.BONE_DIRECTOR.addSingle(t)),r.add(e)}while(zt(r,h,s+90));break;case"down":var c=new Phaser.Math.Vector2(n.right,n.bottom),l=new Phaser.Math.Vector2(n.left,n.bottom);t.angle=s+180,e.rotate(Phaser.Math.DegToRad(s-180)),c.subtract(e),l.add(e);do{t.x=c.x,t.y=c.y,this.Bones.push(this.BONE_DIRECTOR.addSingle(t)),c.add(e)}while(zt(c,l,s+180));break;case"left":var d=this.addTo.getTopRight(),u=this.addTo.getBottomRight();t.angle=s+270,e.rotate(Phaser.Math.DegToRad(s-270)),d.subtract(e),u.add(e);do{t.x=d.x,t.y=d.y,this.Bones.push(this.BONE_DIRECTOR.addSingle(t)),d.add(e)}while(zt(d,u,s+270))}this.scene.time.delayedCall(this.lifetime+65,this.destroyStab,void 0,this)}}function Gt(t){this.Zone.moving&&"warning"===this.state&&(this.warnBox.clear(),this.setWarn())}function Nt(){for(var t=0,e=this.Bones;t<e.length;t++){var s=e[t];s.removeAll(!0),s.destroy()}this.warnBox&&this.warnBox.destroy(),this.destroy()}function Vt(){var t=this.director.CombatzoneDirector.thickness;switch(this.direction){case"up":var e=this.addTo.getBottomLeft(),s=this.addTo.getBottomRight();this.warnBox.strokeRect(e.x+(t+2),e.y+2,s.x-(e.x+(2*t+4)),this.length);break;case"right":e=this.addTo.getTopLeft(),s=this.addTo.getBottomLeft(),this.warnBox.strokeRect(e.x-2,e.y+(t+2),-this.length,s.y-(e.y+(2*t+4)));break;case"down":e=this.addTo.getTopRight(),s=this.addTo.getTopLeft(),this.warnBox.strokeRect(e.x-(t+2),e.y-2,s.x-(e.x-(2*t+4)),-this.length);break;case"left":e=this.addTo.getTopRight(),s=this.addTo.getBottomRight(),this.warnBox.strokeRect(e.x+2,e.y+(2+t),this.length,s.y-(e.y+(2*t+4)))}this.director.CombatzoneDirector.draws.push(this.warnBox)}var Yt=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),Wt=function(t){function e(e,s,i,n){var o=t.call(this,e,0,0)||this;e.add.existing(o);var a=w(s,{zone:{type:"string",default:"main"},direction:{type:"string",default:"down"},length:{type:"number",default:20},wait:{type:"number",default:1e3},lifetime:{type:"number",default:750},slam:{type:["string","boolean"],default:!1},color:{type:["number","string"],default:0},onlyWarn:{type:"boolean",default:!1}},i.AttackLoader.runAttackPos);return o.director=i,o.BONE_DIRECTOR=n,o.Bones=[],o.state="warning",o.scene.sound.play(p.Audio.warning),o.color=a.color,o.direction=a.direction,o.Zone=o.director.CombatzoneDirector.getZone(a.zone),o.length=a.length,o.lifetime=a.lifetime,o.wait=a.wait,o.setWarn=Vt,o.spawnStab=Ft,o.destroyStab=Nt,o.update=Gt,o.warnBox=o.scene.add.graphics({lineStyle:{color:16711680}}),o.warnBox.setDepth(1),o.warnBox.clear(),o.warnBox.setVisible(!1),o.addTo=o.Zone[o.direction],o.setWarn(),a.slam&&(!0===a.slam?o.director.Heart.setGravity({direction:o.direction,slam:!0,autoInit:!1,slamAnim:"".concat(o.direction,"Slam"),color:"blue"}):o.director.Heart.setGravity(a.slam)),a.onlyWarn?o.timerEvent=o.scene.time.delayedCall(o.wait,o.destroy,void 0,o):o.timerEvent=o.scene.time.delayedCall(o.wait,o.spawnStab,void 0,o),o}return Yt(e,t),e.prototype.destroy=function(e){this.warnBox&&(this.warnBox.clear(),this.warnBox.destroy()),this.timerEvent&&this.timerEvent.remove(),t.prototype.destroy.call(this,e)},e}(Phaser.GameObjects.Zone);const Xt=Wt;function Zt(){if(this.scene)if(this.Bones.length<=0)this.destroy();else{if(this.startAngle+=this.rotateSpeed,this.oldAngle!==this.angle){var t=new Phaser.Math.Vector2(0,this.boneRadius/2+this.spaceRadius);t.rotate(Phaser.Math.DegToRad(this.startAngle));for(var e=this.startAngle-this.oldAngle,s=this.getPadding(),i=0,n=this.Bones;i<n.length;i++)(c=n[i]).destroyed||(c.setPosition(t.x+this.x,t.y+this.y),c.angle+=e,this.lockLength||(c.displayLength=this.boneRadius)),t.rotate(Phaser.Math.DegToRad(s))}if("running"===this.scene.director.Debug.state&&this.middlePoint&&(this.middlePoint.clear(),this.middlePoint.x=this.x,this.middlePoint.y=this.y,this.middlePoint.fillCircle(0,0,5)),this.oldX!==this.x)for(var o=0,a=this.Bones;o<a.length;o++)(c=a[o]).x+=this.x-this.oldX;if(this.oldY!==this.y)for(var r=0,h=this.Bones;r<h.length;r++){var c;(c=h[r]).y+=this.y-this.oldY}this.oldX=this.x,this.oldY=this.y,this.oldAngle=this.startAngle}}function Jt(){return"equal"===this.padding?"single"===this.count?0:360/this.count:this.padding}var Ut=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),qt=function(t){function e(e,s,i){var n=t.call(this,e,s.x||0,s.y||0)||this;e.add.existing(n),n.BoneDirector=i;var o=w(s,{x:{type:"number",default:0},y:{type:"number",default:0},spaceRadius:{type:"number",default:30},boneRadius:{type:"number",default:30},count:{type:["number","string"],default:4},startAngle:{type:"number",default:0},padding:{type:["number","string"],default:"equal"},rotateSpeed:{type:"number",default:1},tween:{type:["object","boolean"],default:!1},boneConfig:{type:["object","boolean"],default:!1},stepAngle:{type:"boolean",default:!0}},n.BoneDirector.director.AttackLoader.runAttackPos);n.spaceRadius=o.spaceRadius,n.boneRadius=o.boneRadius,n.count=o.count,n.startAngle=o.startAngle,n.padding=o.padding,n.rotateSpeed=o.rotateSpeed,n.getPadding=Jt,$s&&(n.middlePoint=e.add.graphics({x:n.x,y:n.y,fillStyle:{color:65280}}),n.middlePoint.setDepth(p.Depth.debug),n.middlePoint.fillRect(0,0,3,3),n.angleLine=e.add.line(n.x,n.y,n.x,n.y).setOrigin(0),n.angleLine.setAngle(n.angle)),o.boneConfig?n.Config=T(s.boneConfig):n.Config={x:0,y:0,anchor:{x:"middle",y:"middle"}},n.Config.angle=n.Config.angle||0;var a=new Phaser.Math.Vector2(0,n.boneRadius/2+n.spaceRadius);if(a.rotate(Phaser.Math.DegToRad(n.startAngle)),n.Config.angle+=n.startAngle,n.Config.length?n.lockLength=!0:(n.lockLength=!1,n.Config.length=n.boneRadius),"single"===n.count){n.Config.x=a.x+n.x,n.Config.y=a.y+n.y;var r=i.addSingle(n.Config);r.once("destroy",(function(){n.Bones=[]})),n.Bones=[r]}else{n.Bones=[];for(var h=function(t){c.Config.x=a.x+c.x,c.Config.y=a.y+c.y;var e=i.addSingle(c.Config),s=c.Bones.length-1;e.once("destroy",(function(){n.Bones.splice(s,1)})),c.Bones.push(e),a.rotate(Phaser.Math.DegToRad(c.getPadding())),o.stepAngle&&(c.Config.angle+=c.getPadding())},c=this,l=0;l<n.count;l++)h()}return o.tween&&C(e,n,o.tween),n.setPosition(o.x,o.y),n.oldAngle=n.startAngle,n.oldX=n.x,n.oldY=n.y,n.update=Zt,n}return Ut(e,t),Object.defineProperty(e.prototype,"centerX",{get:function(){return this.x},set:function(t){for(var e=0,s=this.Bones;e<s.length;e++)s[e].x+=t-this.x;this.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this.y},set:function(t){for(var e=0,s=this.Bones;e<s.length;e++)s[e].y+=t-this.y;this.y=t},enumerable:!1,configurable:!0}),e.prototype.destroy=function(e){this.middlePoint&&(this.middlePoint.clear(),this.middlePoint.destroy());for(var s=0,i=this.Bones;s<i.length;s++){var n=i[s];n.destroyed||n.destroy(e)}this.scene&&this.scene.tweens.killTweensOf(this),t.prototype.destroy.call(this,e)},e}(Phaser.GameObjects.Zone);const $t=qt;function Qt(t){var e=w(t,{x:{type:"number",default:0},y:{type:"number",default:0},angle:{type:"number",default:0},padding:{type:"number",default:20},length:{type:"number",default:100},topLength:{type:"number",default:20},speed:{type:"number",default:0},speedAngle:{type:"number",default:0},anchor:{type:"object",default:{x:"bottom",y:"bottom"}},lifetime:{type:["number","boolean"],default:!1},tween:{type:["object","boolean"],default:!1}},this.director.AttackLoader.runAttackPos),s=e.x||0,i=e.y||0,n=e.padding||20,o=e.length||100,a=e.topLength||20,r={x:s,y:i,length:a,angle:e.angle,speed:e.speed,speedAngle:e.speedAngle,anchor:e.anchor,tween:e.tween,lifetime:e.lifetime};this.addSingle(r);var h=new Phaser.Math.Vector2(s,i+n+a);e.angle&&Phaser.Math.RotateAround(h,s,i,Phaser.Math.DegToRad(e.angle)),r.x=h.x,r.y=h.y,r.length=o-(n+a),this.addSingle(r)}function te(t){for(var e=0,s=this.getChildren();e<s.length;e++)(r=s[e]).update(),r.visible||r.onRender||"menu"===r.moveType||(this.director.CombatzoneDirector.draws.push(r),r.onRender=!0);for(var i=0,n=this.stabs;i<n.length;i++)(r=n[i]).update();for(var o=0,a=this.circles;o<a.length;o++){var r;(r=a[o]).update()}}function ee(t,e){if("number"==typeof e)return t+e;if("object"==typeof e){if("values"in e)return e.values[Phaser.Math.Between(0,e.values.length)];var s=0;return e.add&&(s=t),e.integer?Phaser.Math.Between(e.min||0,e.max)+s:Phaser.Math.FloatBetween(e.min||0,e.max)+s}return console.error("".concat(e," is not number or object.")),0}function se(t,e,s){var i=t;s&&(i=T(t));for(var n=0,o=Object.keys(e);n<o.length;n++){var a=o[n],r=i[a],h=e[a];if(null!=r)switch(typeof r){case"object":i[a]=se(r,h);break;case"number":i[a]=ee(r,h);break;default:console.warn("".concat(String(a),"(").concat(typeof t[a],") is not number."))}else console.warn("".concat(String(a)," is not defined."))}return i}function ie(t){var e,s,i=this,n=w(t,{x:{type:"number",default:0},y:{type:"number",default:0},angle:{type:"number",default:0},speed:{type:"number",default:0},speedAngle:{type:"number",default:0},length:{type:"number",default:150},frequency:{type:"number",default:1},amplitude:{type:"number",default:20},padding:{type:"number",default:30},interval:{type:"number",default:75},count:{type:"number",default:20},step:{type:["object","boolean"],default:!1},color:{type:["number","string"],default:0},lifetime:{type:["number","boolean"],default:!1}},this.director.AttackLoader.runAttackPos),o={x:n.x,y:n.y,length:n.length,speed:n.speed,speedAngle:n.speedAngle,angle:n.angle,frequency:n.frequency,amplitude:n.amplitude,padding:n.padding,interval:n.interval,count:n.count,step:n.step,color:n.color,lifetime:n.lifetime},a=0;this.repeats.push(this.scene.time.addEvent({callback:function(){if(e={x:o.x,y:o.y,length:o.length/2-o.padding/2,speed:o.speed||0,speedAngle:o.speedAngle||0,angle:o.angle||0,lifetime:o.lifetime},s={x:o.x,y:o.y+o.length/2+o.padding/2,length:o.length/2-o.padding/2,speed:o.speed||0,speedAngle:o.speedAngle||0,angle:o.angle||0,tweenAnchor:"bottom",lifetime:o.lifetime},o.angle){var t=new Phaser.Math.Vector2(s.x,s.y);Phaser.Math.RotateAround(t,o.x,o.y,Phaser.Math.DegToRad(o.angle)),s.x=t.x,s.y=t.y}if(e.length+=Math.sin(a)*o.amplitude,s.length-=Math.sin(a)*o.amplitude,s.angle){var n=new Phaser.Math.Vector2(0,Math.sin(a)*o.amplitude);Phaser.Math.Rotate(n,Phaser.Math.DegToRad(s.angle)),s.y+=n.y,s.x+=n.x}else s.y+=Math.sin(a)*o.amplitude;i.addSingle(e),i.addSingle(s),o.step&&se(o,o.step),a+=o.interval*o.frequency},callbackScope:this,args:[],repeat:o.count,delay:o.interval}))}function ne(t,e){var s=this,i=T(t);if(i.count=i.count||5,i.delay=i.delay||0,i.delay&&i.delay>0)this.repeats.push(this.scene.time.addEvent({callback:function(){s.addSingle(i,e,{step:!0,delay:!0,count:!0,startAt:!0}),i.step&&se(i,i.step)},callbackScope:this,args:[],repeat:i.count,delay:i.delay,startAt:i.startAt}));else for(var n=0;n<i.count;n++)this.addSingle(i,e,{step:!0,delay:!0,count:!0,startAt:!0}),i.step&&se(i,i.step)}function oe(t,e){O.call(this,t,e)}var ae=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),re=function(t){function e(e,s,i){var n=t.call(this,e)||this;return n.collision=s,n.director=i,e.add.existing(n),n.repeats=[],n.stabs=[],n.circles=[],n.stabBone=Xt,n.CircleBone=$t,n.addSine=ie,n.addMulti=ne,n.addGap=Qt,n.router=oe,n.update=te,n}return ae(e,t),e.prototype.addSingle=function(t,e,s){var i;return(i=new Ht(this.scene,t,this.collision,this.director,e,s)).setDepth(p.Depth.bone),this.add(i),i},e.prototype.addCircle=function(t){this.circles.push(new this.CircleBone(this.scene,t,this))},e.prototype.addStab=function(t){this.stabs.push(new this.stabBone(this.scene,t,this.director,this))},e.prototype.clear=function(e,s){this.scene.tweens.killTweensOf(this.getChildren()),t.prototype.clear.call(this,e,s);for(var i=0,n=this.circles;i<n.length;i++)n[i].destroy();for(var o=0,a=this.stabs;o<a.length;o++)a[o].destroy();for(var r=0,h=this.repeats;r<h.length;r++)h[r].remove();return this},e}(Phaser.GameObjects.Group);const he=re;function ce(t,e){this.Face.anims.update(t,e);var s=new Phaser.Geom.Point(this.x+this.Face.x,this.y+this.Face.y),i=(s=Phaser.Math.RotateAround(s,this.x,this.y,Phaser.Math.DegToRad(this.angle))).x,n=s.y,o=this.scene.scale;if("moving"===this.state||"readyBlast"===this.state);else{var a=Phaser.Math.Angle.WrapDegrees(this.angle),r=Math.max(this.Face.displayWidth,this.Face.displayHeight);a>=0?(a>=90&&(o.height<n-r||o.width<i-r)||o.width<i-r||0>n+r)&&(this.stopped||this.stopMove()):(a>=-90&&(0>i+r||0>n+r)||0>i+r||o.height<n-r)&&(this.stopped||this.stopMove()),"endBlast"===this.state&&this.stopped&&(this.removeAll(!0),this.destroy())}}var le=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),de=function(t){function e(e,s,i,n){var o=t.call(this,e,n,s.color)||this;e.sound.play(p.Audio.blaster),e.add.existing(o),o.director=n;var a=w(s,{startX:{type:"number",default:0},startY:{type:"number",default:0},endX:{type:"number",default:0},endY:{type:"number",default:0},startAngle:{type:"number",default:0},endAngle:{type:"number",default:0},size:{type:"number",default:40},wait:{type:"number",default:500},blastTime:{type:"number",default:500},color:{type:["number","string"],default:0},anchor:{type:"object",default:{x:"bottom",y:"bottom"}}},o.director.AttackLoader.runAttackPos);o.startX=a.startX,o.startY=a.startY,o.endX=a.endX,o.endY=a.endY,o.wait=a.wait,o.blastTime=a.blastTime,o.endAngle=a.endAngle,o.startAngle=a.startAngle,o.anchor=a.anchor,o.collision=i,o.Face=e.add.sprite(0,0,p.Sheet.blaster),o.size=a.size,o.Laser=o.scene.add.sprite(0,0,p.Image.block);var r=o.size/o.Laser.height;o.Laser.setScale(r,100);var h=o.size/o.Face.height;o.Face.setScale(2.5*h,Math.max(2,2.5*h)),o.Laser.setVisible(!1),o.add([o.Laser]),o.Arc=e.add.arc(0,-o.Laser.displayHeight/2+o.Laser.x,o.Laser.displayWidth/2,180,360,!1,16777215),o.Arc.setTint=o.Arc.setFillStyle,o.add(o.Arc),o.Arc.setVisible(!1),o.setAngle(o.startAngle),o.setSize(o.Laser.displayWidth-10,o.Laser.displayHeight);var c=o.scene.matter.add.gameObject(o);c.setIgnoreGravity(!0),c.setCollidesWith(0),c.setCollisionCategory(o.collision),c.setFrictionAir(0),c.setMass(p.MASS);var l={x:a.startX,y:a.startY,width:o.Face.displayWidth,height:o.Face.displayHeight,angle:a.startAngle,anchor:o.anchor};Ot(l),o.Face.setPosition(l.x,l.y),o.Face.setDepth(p.Depth.blaster);var d=Phaser.Math.Rotate({x:0,y:o.Face.displayHeight},Phaser.Math.DegToRad(a.endAngle)),u={x:a.endX-d.x,y:a.endY-d.y,width:o.Laser.displayWidth,height:3*o.Face.displayHeight,angle:a.endAngle,anchor:o.anchor,origin:{height:o.Face.displayHeight}};Ot(u);var g={x:a.endX,y:a.endY,width:o.Laser.displayWidth,height:o.height+2*o.Face.displayHeight,angle:a.endAngle,anchor:o.anchor,origin:{height:o.Face.displayHeight}};return Ot(g),o.setPosition(g.x,g.y),o.setAngle(g.angle),o.propTime=Math.min(o.wait,700),e.tweens.add({targets:o.Face,delay:0,props:{x:{value:u.x,duration:o.propTime},y:{value:u.y,duration:o.propTime},angle:{value:u.angle,duration:o.propTime}},duration:o.propTime,ease:"Sine.easeOut",onComplete:o.blastWait,callbackScope:o}),$s&&(o.debuGraphic=e.add.graphics({fillStyle:{color:65280}}).setDepth(p.Depth.debug),o.debuGraphic.fillCircle(s.endX||0,s.endY||0,5)),o.setDepth(p.Depth.blaster),o.stopped=!1,o.haveDamage=!1,o.state="moving",o.tints=[o.Face,o.Laser,o.Arc],o.colorKey=a.color,o}return le(e,t),e.prototype.blastWait=function(){if(void 0!==this.scene){this.Face.setPosition(0,-this.Laser.displayHeight/2-this.Face.displayHeight/2),this.Face.setAngle(),this.add(this.Face),this.bringToTop(this.Face);var t=this.wait-this.propTime;this.wait<=0?this.faceOpen():(this.state="readyBlast",this.scene.time.delayedCall(t,this.faceOpen,void 0,this))}},e.prototype.faceOpen=function(){void 0!==this.scene&&(this.Face.anims.play(p.Anim.blastStart,!0),this.Laser.setVisible(!0),this.Arc.setVisible(!0),this.scene.tweens.add({targets:[this.Laser,this.Arc],props:{alpha:{value:1,duration:100},displayWidth:{value:this.Laser.displayWidth}},duration:200,onComplete:this.blasting,onCompleteScope:this}),this.Laser.displayWidth=0,this.Arc.displayWidth=0,this.Laser.alpha=0,this.Arc.alpha=0)},e.prototype.blasting=function(){void 0!==this.scene&&(this.state="blasting",this.haveDamage=!0,this.scene.sound.play(p.Audio.blast1,{volume:.5}),this.scene.sound.play(p.Audio.blast0),this.scene.cameras.main.shake(100,.005),this.Face.anims.play(p.Anim.blasting,!0),this.Laser.displayWidth=this.size-10,this.Arc.displayWidth=this.size-10,this.laserTween=this.scene.tweens.add({targets:[this.Laser,this.Arc],props:{displayWidth:Math.min(this.size+20,2*this.Laser.displayWidth)},yoyo:!0,ease:Phaser.Math.Easing.Linear,duration:150,repeat:-1}),this.scene.matter.applyForceFromAngle(this.body,-p.MASS/30,Phaser.Math.DegToRad(this.angle+90)),this.scene.time.delayedCall(this.blastTime,this.endBlast,void 0,this))},e.prototype.stopMove=function(){this.scene.matter.setVelocity(this.body,0,0),this.stopped=!0},e.prototype.endBlast=function(){var t=this;void 0!==this.scene&&(this.haveDamage=!1,this.laserTween.stop(),this.scene.tweens.add({targets:[this.Laser,this.Arc],props:{alpha:{value:0,duration:350},displayWidth:{value:10,duration:300}},onComplete:function(){t.Arc.setVisible(!1),t.state="endBlast"},onCompleteScope:this}))},e.prototype.destroy=function(e){this.scene&&("moving"!==this.state||e||this.Face.destroy(),this.debuGraphic&&this.debuGraphic.destroy(e),t.prototype.destroy.call(this,e))},e.prototype.update=function(e,s){ce.call(this,e,s),this.haveDamage&&t.prototype.update.call(this)},e}(_t);const ue=de;var pe=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),ge=function(t){function e(e,s,i){var n=t.call(this,e)||this;return n.collision=s,n.director=i,e.add.existing(n),e.anims.create({key:p.Anim.blastStart,frames:[{key:p.Sheet.blaster,frame:"compound"},{key:p.Sheet.blaster,frame:"double"}],duration:200}),e.anims.create({key:p.Anim.blasting,frames:[{key:p.Sheet.blaster,frame:"left"},{key:p.Sheet.blaster,frame:"right"}],duration:100,repeat:-1}),n}return pe(e,t),e.prototype.addSingle=function(t){var e;return e=new ue(this.scene,t,this.collision,this.director),this.add(e),e},e.prototype.router=function(t,e){O.call(this,t,e)},e.prototype.update=function(t,e){if(this.getChildren()[0])for(var s=0,i=this.getChildren();s<i.length;s++)i[s].update(t,e)},e.prototype.playerTurnInit=function(){this.clear(!1,!0)},e}(Phaser.GameObjects.Group);const ye=ge;function fe(t,e){try{var s=this.director.AttackLoader.runAttackPos,i=void 0;if(!this[e])throw i=!1,new Error("type name is undefined ".concat(e," "));if((i=O.call(this,t,e))||this.director.AttackLoader.runAttackPos++,i&&s===this.director.AttackLoader.runAttackPos)throw new Error("detected infinity loop at ".concat(this.director.AttackLoader.runAttackPos," "));return i}catch(t){return console.error(t.message),this.director.AttackLoader.runAttackPos++,!0}}const me=function(t){try{var e;if("#"!==t[0])throw new Error("label name is must be start a # at ".concat(this.director.AttackLoader.runAttackPos));e=t.slice(1);for(var s=0;s<this.director.AttackLoader.loadingAttack.length;s++){var i=this.director.AttackLoader.loadingAttack[s];if("jump"===i.category&&"label"===i.type&&e===i.data.name)return s}throw new Error("label name is not defined at ".concat(this.director.AttackLoader.runAttackPos))}catch(t){return console.log(t.message),0}};function be(t){var e,s=w(t,{to:["number","string"]},this.director.AttackLoader.runAttackPos);return e="number"!=typeof s.to?this.searchLabel(s.to):s.to,this.director.AttackLoader.runAttackPos=e,!0}function ve(t){var e,s=w(t,{to:["number","string"],count:{type:"number",default:1},remain:{type:["string","boolean"],default:!1}},this.director.AttackLoader.runAttackPos),i=this.director.AttackLoader.runAttackPos;return void 0===this.counter[i]&&(this.counter[i]=s.count),e="number"!=typeof s.to?this.searchLabel(s.to):s.to,this.counter[i]>0?(this.director.AttackLoader.runAttackPos=e,this.counter[i]--,s.remain&&(this.director.GameMath.variables[s.remain]=this.counter[i]),!0):(this.counter[i]=void 0,!1)}function xe(t){var e,s=w(t,{to:["number","string"]},this.director.AttackLoader.runAttackPos);return e="number"!=typeof s.to?this.searchLabel(s.to):s.to,this.director.AttackLoader.runAttackPos+=e,!0}function we(t){var e,s=w(t,{to:["number","string"],count:{type:"number",default:1},remain:{type:["string","boolean"],default:!1}},this.director.AttackLoader.runAttackPos),i=this.director.AttackLoader.runAttackPos;return void 0===this.counter[i]&&(this.counter[i]=t.count),e="number"!=typeof s.to?this.searchLabel(s.to):s.to,this.counter[i]>0?(this.director.AttackLoader.runAttackPos+=e,this.counter[i]--,s.remain&&(this.director.GameMath.variables[s.remain]=this.counter[i]),!0):(this.counter[i]=void 0,!1)}function Ae(t){var e=w(t,{to:"object",rel:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos),s=Phaser.Math.Between(0,e.to.length-1),i=e.to[s];return"number"!=typeof i&&(i=this.searchLabel(i)),e.rel?this.director.AttackLoader.runAttackPos+=i:this.director.AttackLoader.runAttackPos=i,!0}function ke(t){var e=w(t,{to:["number","string"],rel:{type:"boolean",default:!1},count:{type:"number",default:1},once:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos),s=this.director.AttackLoader.runAttackPos;if(!1===this.counter[s])return!1;if(void 0===this.counter[s]&&(this.counter[s]=e.count),this.counter[s]>0)return this.counter[s]--,!1;var i;return i="number"!=typeof e.to?this.searchLabel(e.to):e.to,e.rel?this.director.AttackLoader.runAttackPos+=i:this.director.AttackLoader.runAttackPos=i,e.once?this.counter[s]=!1:this.counter[s]=void 0,!0}function Pe(t){var e=w(t,{to:["number","string"],type:"string",valueA:"number",valueB:{type:"number",default:0},rel:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos),s=!1;switch(e.type){case"true":e.valueA&&(s=!0);break;case"false":e.valueA||(s=!0);break;case"zero":0===e.valueA&&(s=!0);break;case"notZero":0!==e.valueA&&(s=!0);break;default:if(null==e.valueB)return console.warn("valueB is not defined at ".concat(this.director.AttackLoader.runAttackPos)),!1;switch(e.type){case"equal":case"=":e.valueA===e.valueB&&(s=!0);break;case"notEqual":case"!=":e.valueA!==e.valueB&&(s=!0);break;case"less":case"<":e.valueA<e.valueB&&(s=!0);break;case"notLess":case">=":e.valueA<e.valueB||(s=!0);break;case"greater":case">":e.valueA>e.valueB&&(s=!0);break;case"notGreater":case"<=":e.valueA>e.valueB||(s=!0);break;default:console.error("jump type is incorrect at ".concat(this.director.AttackLoader.runAttackPos,"\n    name:").concat(e.type))}}if(s){var i;return i="number"!=typeof e.to?this.searchLabel(e.to):e.to,e.rel?this.director.AttackLoader.runAttackPos+=i:this.director.AttackLoader.runAttackPos=i,!0}return!1}function Se(){for(var t in this.counter)Object.prototype.hasOwnProperty.call(this.counter,t)&&(this.counter[t]=void 0)}const Te=function(){function t(t){this.director=t,this.counter=[],this.searchLabel=me,this.ABS=be,this.ABSCount=ve,this.REL=xe,this.RELCount=we,this.RND=Ae,this.countOut=ke,this.compare=Pe,this.init=Se,this.router=fe}return t.prototype.label=function(){return!1},t}();var De=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),Ce=function(t){function e(e,s,i,n,o){var a=t.call(this,e,s,i)||this;return a.zKey=n,a.director=o,a.speechBack=e.add.image(0,0,p.Image.speech),a.text=e.add.text(-80,-40,"",{fontFamily:"comicsansfont",color:"#000",fontSize:"14px"}),a.add([a.speechBack,a.text]),e.add.existing(a),a.setDepth(p.Depth.sansText),a.setActive(!1),a.setVisible(!1),a}return De(e,t),e.prototype.setTextInst=function(t){this.speechId.remove(),this.text.setText(t),this.zKey.once("down",this.endSpeech.bind(this))},e.prototype.rollDiaText=function(t){var e=this,s=t.text.length,i=0;return this.scene.time.addEvent({callback:function(){e.text.setText(e.text.text+t.text[i]),t.sound&&" "!==e.text.text[i]&&e.scene.sound.play(p.Audio[t.sound]),i>=s-1&&(e.zKey.off("down"),e.zKey.once("down",e.endSpeech.bind(e))),++i},repeat:s-1,delay:t.speed})},e.prototype.speech=function(t){var e=w(t,{text:"string",sound:{type:["string","boolean"],default:"sansText"},poses:{type:["object","boolean"],default:!1},speed:{type:"number",default:35}},this.director.AttackLoader.runAttackPos);void 0!==this.scene&&(e.poses&&this.director.Sans.setVisual(e.poses),this.setPosition(this.director.Sans.x+170,this.director.Sans.y-this.director.Sans.torso.displayHeight),this.setActive(!0),this.setVisible(!0),this.text.setText(""),this.speechId=this.rollDiaText(e),this.zKey.once("down",this.setTextInst.bind(this,t.text)))},e.prototype.endSpeech=function(){void 0!==this.scene&&(this.setActive(!1),this.setVisible(!1),this.director.AttackLoader.startAttack())},e.prototype.router=function(t,e){O.call(this,t,e)},e}(Phaser.GameObjects.Container);const Ie=Ce;function Oe(t,e){if("running"===this.state){var s=this.scene.director.AttackLoader;this.active&&s.SingleAttack&&this.showParameter.setText("\ntime:".concat(t,"\nfps:").concat(e,"\nload file: ").concat(s.attackName,"\nattack: \n    where: ").concat(s.runAttackPos,"\n    category: ").concat(s.SingleAttack.category,"\n    type: ").concat(s.SingleAttack.type,"\n    wait: ").concat(s.SingleAttack.wait,"\nturn: ").concat(s.loadFilePos," \nphase: ").concat(s.phase,"\nsingle: ").concat(!!s.playSingle,"\nmoving: ").concat(this.director.Heart.moving,"\npressKey: ").concat(this.scene.cursors.getDownKey()," ")),Phaser.Input.Keyboard.JustDown(this.scene.tKey)&&(this.showParameter.text+="\npaused",this.scene.scene.pause(p.Scene.battleScene),this.scene.scene.launch(p.Scene.pause)),Phaser.Input.Keyboard.JustDown(this.scene.hKey)&&this.director.Statuses.healHp({amount:99,debug:!0})}}function Re(t){this.state=t?"running":"sleep",this.setActive(t),this.setVisible(t)}var Me=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const je=function(t){function e(e,s){var i=t.call(this,e)||this;return i.director=s,i.showParameter=e.add.text(0,0,"",{fontFamily:"battlefont",fontSize:"64px"}).setScale(1/4).setDepth(p.Depth.debug),i.state="running",i.setMode=Re,i.update=Oe,i}return Me(e,t),e}(Phaser.GameObjects.Container);function Le(t,e){O.call(this,t,e)}function Be(t){if("$"===t[0]){var e,s=t.slice(1);return void 0!==(e=this.variables[s])?e:(console.error("variable name is not defined ".concat(t)),0)}return t}function _e(t){this.variables[t.variable]=t.value}function Ee(t){var e=w(t,{variable:"string",valueA:"number",valueB:"number"},this.director.AttackLoader.runAttackPos),s=e.valueA,i=e.valueB;this.variables[e.variable]=s+i}function Ke(t){var e=w(t,{variable:"string",valueA:"number",valueB:"number"},this.director.AttackLoader.runAttackPos),s=e.valueA,i=e.valueB;this.variables[e.variable]=s-i}function He(t){return"string"==typeof t&&"$"===t[0]?this.variableToUse(t):t}function ze(t){var e=w(t,{variable:"string",min:{type:"number",default:0},max:"number",padding:{type:"number",default:0},integer:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos),s=e.padding,i=e.min;e.max-i<=2*s&&console.error("padding is too bigger at ".concat(this.scene.director.AttackLoader.runAttackPos)),e.integer?this.variables[e.variable]=Phaser.Math.Between(i+s,e.max-s):this.variables[e.variable]=Phaser.Math.FloatBetween(i+s,e.max-s)}const Fe=function(t){var e=w(t,{variable:"string",valueA:"number",valueB:"number"},this.director.AttackLoader.runAttackPos),s=e.valueA,i=e.valueB;this.variables[e.variable]=s*i};function Ge(t){var e=w(t,{variable:"string",valueA:"number",valueB:"number"},this.director.AttackLoader.runAttackPos),s=e.valueA,i=e.valueB;this.variables[e.variable]=s/i}function Ne(t){var e=w(t,{variable:"string",values:"object"},this.director.AttackLoader.runAttackPos),s=Phaser.Math.Between(0,e.values.length-1);this.variables[e.variable]=e.values[s]}function Ve(t){var e=w(t,{variable:"string",valueA:"number",valueB:"number"},this.director.AttackLoader.runAttackPos),s=e.valueA,i=e.valueB;this.variables[e.variable]=s%i}function Ye(t){var e=w(t,{pointX:{type:"number",default:0},pointY:{type:"number",default:0},originX:{type:"number",default:0},originY:{type:"number",default:0},x:{type:["string","boolean"],default:!1},y:{type:["string","boolean"],default:!1},angle:"number"},this.director.AttackLoader.runAttackPos),s=new Phaser.Math.Vector2(e.pointX,e.pointY),i=Phaser.Math.DegToRad(e.angle);i=Phaser.Math.Angle.Wrap(i),e.originX||e.originY?Phaser.Math.RotateAround(s,e.originX,e.originY,i):Phaser.Math.Rotate(s,i),e.x&&(this.variables[e.x]=s.x),e.y&&(this.variables[e.y]=s.y)}function We(t){var e=w(t,{angle:"string",fromX:{type:"number",default:0},fromY:{type:"number",default:0},toX:{type:"number",default:0},toY:{type:"number",default:0},isRadian:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos),s=-Phaser.Math.Angle.BetweenY(e.fromX,e.fromY,e.toX,e.toY);t.isRadian?this.variables[t.angle]=s:this.variables[t.angle]=Phaser.Math.RadToDeg(s)}function Xe(){for(var t in this.variables)delete this.variables[t]}const Ze=function(t,e){this.scene=t,this.director=e,this.variables={},this.router=Le,this.variableToUse=Be,this.set=_e,this.add=Ee,this.sub=Ke,this.rnd=ze,this.mul=Fe,this.div=Ge,this.rndValues=Ne,this.mod=Ve,this.rotate=Ye,this.betWeenAngle=We,this.findVariable=He,this.init=Xe};function Je(t,e){for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){var i=t[s];"string"==typeof i&&"$"===i[0]?(e[s]=this.GameMath.findVariable(i),void 0===e[s]&&console.warn("can't find variable on ".concat(s))):"object"==typeof i?Array.isArray(i)?(e[s]=[],Je.call(this,i,e[s])):(e[s]={},Je.call(this,i,e[s])):e[s]=i}}function Ue(t){var e;for(var s in e={},t)if(Object.prototype.hasOwnProperty.call(t,s)){var i=t[s];"object"==typeof i?(e[s]={},Je.call(this,i,e[s])):"string"==typeof i&&"$"===i[0]?e[s]=this.GameMath.findVariable(i):e[s]=i}return e}function qe(t,e){O.call(this,t,e)}function $e(t){this.scene.sound.stopByKey(p.Audio[t.sound]),this.scene.sound.play(p.Audio[t.sound],t.extra)}function Qe(t){this.scene.sound.stopByKey(p.Audio[t.sound])}const ts=function(t,e){this.scene=t,this.director=e,this.play=$e,this.stop=Qe,this.router=qe};function es(){this.Middle.setScale(this.boxLength/this.Middle.width,1),this.Left.setPosition(-this.Middle.displayWidth/2,0),this.Right.setPosition(this.Middle.displayWidth/2,0)}var ss=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),is=function(t){function e(e,s){var i=t.call(this,e,s.x,s.y)||this;return i.boxLength=s.length,i.Middle=e.add.sprite(0,0,p.Sheet.platForm,"middle"),i.Middle.setScale(s.length/i.Middle.width,1),i.add(i.Middle),i.Left=e.add.image(-i.Middle.displayWidth/2,0,p.Sheet.platForm,"left"),i.add(i.Left),i.Right=e.add.image(i.Middle.displayWidth/2,0,p.Sheet.platForm,"right"),i.add(i.Right),e.add.existing(i),s.tint&&(i.Middle.setTint(s.tint),i.Left.setTint(s.tint),i.Right.setTint(s.tint)),i.update=es,i}return ss(e,t),e.prototype.setTint=function(t){this.Middle.setTint(t),this.Left.setTint(t),this.Right.setTint(t)},e}(Phaser.GameObjects.Container);const ns=is;function os(){this.Zone.boxLength=this.platLength,this.Scaffold.boxLength=this.platLength;var t=this.angle;this.setAngle(0);var e=this.body;this.scene.matter.body.scale(e,this.platLength/this.oldLength,1);var s=this.platLength-this.oldLength,i=new Phaser.Math.Vector2(0,s/2);"middle"!==this.tweenAnchor&&("right"===this.tweenAnchor?(i.rotate(Phaser.Math.DegToRad(t+90)),this.x+=i.x,this.y+=i.y):(i.rotate(Phaser.Math.DegToRad(t+270)),this.x+=i.x,this.y+=i.y)),this.setAngle(t)}function as(){if("middle"!==this.tweenAnchor){var t=new Phaser.Math.Vector2(this.x,this.y),e=new Phaser.Math.Vector2(this.x+this.platLength/2,this.y);"left"===this.tweenAnchor?(Phaser.Math.RotateAround(e,this.x,this.y,Phaser.Math.DegToRad(this.oldAngle+180)),Phaser.Math.RotateAround(t,e.x,e.y,Phaser.Math.DegToRad(this.angle-this.oldAngle)),this.setPosition(t.x,t.y)):(Phaser.Math.RotateAround(e,this.x,this.y,Phaser.Math.DegToRad(this.oldAngle)),Phaser.Math.RotateAround(t,e.x,e.y,Phaser.Math.DegToRad(this.angle-this.oldAngle)),this.setPosition(t.x,t.y))}}function rs(){var t=this;if(!this.body)return!1;if(this.scene.tweens.isTweening(this))switch(this.platLength!==this.oldLength&&os.call(this),this.angle!==this.oldAngle&&as.call(this),this.color){case 0:this.Zone.setTint(p.Color.green);break;case 1:this.Zone.setTint(p.Color.purple)}if(this.spin&&this.setAngle(this.angle+this.spin),this.speed)if(this.speedAngle){var e=new Phaser.Math.Vector2(this.speed,0);e.rotate(Phaser.Math.DegToRad(this.speedAngle)),this.x+=e.x,this.y+=e.y}else this.x+=this.speed;this.Zone.update(),this.Scaffold.update();var s=this.x-this.oldPosition.x,i=this.y-this.oldPosition.y;this.MatterObject.setCollidesWith(0);var n=this.director.Heart.Edge;Phaser.Math.RotateAround(n,this.director.Heart.Image.x,this.director.Heart.Image.y,this.rotation);var o=Phaser.Math.Angle.BetweenPointsY({x:this.x,y:this.y},n),a=-this.rotation,r=a-Math.PI/2,h=a+Math.PI/2,c=!1;o>=Math.min(r,h)&&o<=Math.max(r,h)||(this.MatterObject.setCollidesWith(this.heartCol),c=!0);var l=!1;return c&&this.scene.matter.overlap(this.body,[this.scene.director.Heart.Image.body],(function(){if(0===t.color){var e=new Phaser.Math.Vector2(t.scene.director.Heart.Force),n=Phaser.Math.Angle.BetweenPointsY({x:0,y:0},e);n>Math.min(r,h)&&n<Math.max(r,h)&&(t.scene.director.Heart.setDirection(),t.scene.director.Heart.Image.x+=s,t.scene.director.Heart.Image.y+=i,l=!0,t.scene.director.Heart.Force={x:0,y:0})}})),this.oldPosition={x:this.x,y:this.y},this.oldAngle=this.angle,this.oldLength=this.platLength,l}var hs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),cs=function(t){function e(e,s,i,n,o,a){var r=t.call(this,e,0,0)||this;r.collision=i,r.heartCol=n,r.director=e.director;var h=w(s,{x:{type:"number",default:0},y:{type:"number",default:0},angle:{type:"number",default:0},spin:{type:"number",default:0},speed:{type:"number",default:0},speedAngle:{type:"number",default:0},color:{type:["string","number"],default:0},anchor:{type:"object",default:{x:"bottom"}},visible:{type:"boolean",default:!1},length:{type:"number",default:30},lifetime:{type:["number","boolean"],default:!1},tween:{type:"object",default:void 0},tweenAnchor:{type:"string",default:"middle"}},r.director.AttackLoader.runAttackPos,a);if(r.speed=h.speed,r.speedAngle=h.speedAngle,r.spin=h.spin,r.tweenAnchor=h.tweenAnchor,r.platLength=h.length,r.oldLength=r.platLength,r.destroyed=!1,"number"==typeof h.color)r.color=h.color;else switch(h.color){case"green":r.color=0;break;case"purple":r.color=1}r.Scaffold=new ns(e,{x:0,y:0,length:r.platLength}),r.Zone=new ns(e,{x:0,y:-4,length:r.platLength,tint:p.Color[r.colorKey]}),e.add.existing(r),r.add(r.Scaffold),r.add(r.Zone),r.setDepth(p.Depth.debug),r.setSize(r.platLength,r.Scaffold.Middle.displayHeight),r.MatterObject=e.matter.add.gameObject(r),r.MatterObject.setCollisionCategory(i),r.MatterObject.setCollidesWith(0),r.MatterObject.setStatic(!0),r.MatterObject.setBounce(0),r.MatterObject.setFrictionAir(0),r.MatterObject.setMass(p.MASS),r.MatterObject.setStatic(!0),r.MatterObject.body.label=p.Label.platform;var c=Ot({x:h.x,y:h.y,anchor:h.anchor,width:r.platLength,height:r.Scaffold.Middle.displayHeight,angle:h.angle},!0);return r.setPosition(c.x,c.y),r.setAngle(h.angle),r.oldAngle=r.angle,h.tween&&C(e,r,h.tween,{length:"platLength"}),"number"==typeof h.lifetime&&e.time.delayedCall(h.lifetime,(function(){e.tweens.killTweensOf(r),r.removeAll(!0),r.destroy()}),void 0,r),r.oldPosition={x:r.x,y:r.y},h.visible?r.onRender=!1:(r.director.CombatzoneDirector.draws.push(r),r.visible=!1,r.onRender=!0),r.update=rs,r}return hs(e,t),Object.defineProperty(e.prototype,"colorKey",{get:function(){var t;switch(this.color){case 0:t="green";break;case 1:t="purple"}return t},set:function(t){if("number"==typeof t)this.color=2%Math.floor(t);else switch(t){case"green":this.color=0;break;case"purple":this.color=1}switch(this.color){case 0:this.Zone.setTint(p.Color.green);break;case 1:this.Zone.setTint(p.Color.purple)}},enumerable:!1,configurable:!0}),e}(Phaser.GameObjects.Container);const ls=cs;function ds(t,e,s){var i=new ls(this.scene,t,this.collision,this.heartCol,e,s);i.setDepth(p.Depth.platform),this.add(i)}function us(t,e){O.call(this,t,e)}function ps(){for(var t=0,e=this.getChildren();t<e.length;t++){var s=e[t];s.update()&&(0!==s.speed||s.oldPosition.x!==s.x||s.oldPosition.y!==s.y?s.director.Heart.moveWithPlatform=!0:s.director.Heart.moveWithPlatform=!1),s.visible||s.onRender||(this.director.CombatzoneDirector.draws.push(s),s.onRender=!0)}}var gs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const ys=function(t){function e(e,s,i,n){var o=t.call(this,e)||this;return o.director=i,o.collision=s,o.heartCol=n,o.repeats=[],e.add.existing(o),o.addSingle=ds,o.addMulti=ne,o.update=ps,o.router=us,o}return gs(e,t),e.prototype.clear=function(e,s){this.scene.tweens.killTweensOf(this.getChildren()),t.prototype.clear.call(this,e,s);for(var i=0,n=this.repeats;i<n.length;i++)n[i].remove();return this},e}(Phaser.GameObjects.Group);function fs(t,e){O.call(this,t,e)}function ms(t){var e=this,s=w(t,{duration:{type:"number",default:350},sound:{type:["string","boolean"],default:"flash"},removeAll:{type:"boolean",default:!1},pause:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos);this.scene.cameras.cameras.forEach((function(t){t.setVisible(!1)})),s.sound&&this.scene.sound.play(p.Audio[s.sound]),s.removeAll&&this.director.removeAll(!0),s.pause?(this.scene.scene.pause(p.Scene.battleScene),setTimeout((function(){e.scene.scene.resume(p.Scene.battleScene),e.scene.cameras.cameras.forEach((function(t){t.setVisible(!0)})),s.sound&&e.scene.sound.play(p.Audio[s.sound])}),s.duration)):this.scene.time.delayedCall(s.duration,(function(){e.scene.cameras.cameras.forEach((function(t){t.setVisible(!0)})),s.sound&&e.scene.sound.play(p.Audio[s.sound])}),void 0,this)}function bs(t){var e=this,s=w(t,{direction:{type:"string",default:"right"},duration:{type:"number",default:1e3},playAnim:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos);this.director.Heart.setGravity({direction:s.direction,color:"falling"}),this.director.Sans.falling=s.direction,s.playAnim&&this.director.Sans.setVisual({target:"torso",anim:"".concat(s.direction,"Slam"),autoInit:!0}),this.fallingEnd=this.scene.time.delayedCall(s.duration,(function(){e.director.Sans.falling=void 0,e.director.Sans.setVisual({frame:"default"}),e.director.Heart.setGravity({direction:s.direction,color:"blue"})}),void 0,this)}function vs(){this.fallingEnd&&this.fallingEnd.remove(!0)}const xs=function(t,e){this.scene=t,this.director=e,this.flash=ms,this.falling=bs,this.removeAll=vs,this.router=fs};function ws(t){t||(this.Jumps.init(),this.GameMath.init()),this.Effect.removeAll(),this.BoneDirector.clear(!1,!0),this.BlasterDirector.clear(!1,!0),this.PlatFormDirector.clear(!1,!0)}function As(t,e){var s=this;null==e&&(e=!0),"object"!=typeof t&&(console.error("attack is not defined at ".concat(this.runAttackPos)),this.endAttack({})),"endAttack"!==t.category&&"endattack"!==t.category&&(t.data||console.warn("data is not defined at ".concat(this.runAttackPos)),t.type||console.warn("type is not defined at ".concat(this.runAttackPos)));var i=this.director;switch(t.category){case"combatzone":case"combatZone":i.CombatzoneDirector.router(t.data,t.type);break;case"heart":i.Heart.router(t.data,t.type);break;case"bone":i.BoneDirector.router(t.data,t.type);break;case"gasterblaster":case"blaster":i.BlasterDirector.router(t.data,t.type);break;case"sanstext":e=!1,i.SansText.router(t.data,t.type);break;case"sans":i.Sans.router(t.data,t.type);break;case"jump":i.Jumps.router(t.data,t.type);break;case"math":i.GameMath.router(t.data,t.type);break;case"audio":i.AudioPlayer.router(t.data,t.type);break;case"platform":i.PlatFormDirector.router(t.data,t.type);break;case"effect":i.Effect.router(t.data,t.type);break;case"endAttack":case"endattack":e=!1,this.endAttack(t.data);break;default:console.warn("category is not defined at ".concat(this.runAttackPos," "))}"jump"===t.category||"endAttack"===t.category||"endattack"===t.category||this.runAttackPos++,e&&("jump"===t.category&&t.wait&&t.wait>0?this.Loading.startAttack=this.scene.time.delayedCall(t.wait,(function(){s.startAttack()})):this.startAttack())}function ks(){var t;switch(this.phase){case 1:t=this.scene.cache.json.get(this.scene.config.Phase1[this.loadFilePos]),this.attackName=this.scene.config.Phase1[this.loadFilePos];break;case 2:t=this.scene.cache.json.get(this.scene.config.Phase2[this.loadFilePos]),this.attackName=this.scene.config.Phase2[this.loadFilePos]}return t}function Ps(){var t;switch(this.phase){case 1:var e=Phaser.Math.Between(0,this.scene.config.Phase1RND.length-1);t=this.scene.cache.json.get(this.scene.config.Phase1RND[e]),this.attackName=this.scene.config.Phase1RND[e];break;case 2:e=Phaser.Math.Between(0,this.scene.config.Phase2RND.length-1),t=this.scene.cache.json.get(this.scene.config.Phase2RND[e]),this.attackName=this.scene.config.Phase2RND[e]}return t}const Ss=function(){function t(){}return t.showPassed=function(t,e){var s=t.add.text(320,50,e?"success":"failure",{fontFamily:"damageFont",color:e?"#0f0":"#c00",fontSize:"32px"});s.setOrigin(.5),s.setDepth(p.Depth.debug),t.time.delayedCall(1e3,(function(){s&&s.scene&&s.destroy()}))},t.endAttack=function(t){t.Sans.x=320,t.Statuses.hp=t.Statuses.maxHp,t.Statuses.kr=0,t.Statuses.setDisplay(),t.removeAll(),t.Heart.enemyTurnInit(),t.CombatzoneDirector.setRectDefault(!0)},t}();function Ts(){var t=this.director;for(var e in t.removeAll(),t.Heart.enemyTurnInit(),t.CombatzoneDirector.setRectDefault(!0),t.Sans.x=320,this.Loading)if(Object.prototype.hasOwnProperty.call(this.Loading,e)){var s=this.Loading[e];s&&s.remove()}Ss.showPassed(this.scene,!1),this.runAttackPos=0,this.startAttack()}function Ds(t){var e=this,s=this.director;Array.isArray(t)&&(this.loadingAttack=t),this.SingleAttack=this.loadingAttack[this.runAttackPos];var i=s.searchVariable(this.SingleAttack);i.wait&&i.wait>0&&"jump"!==i.category?this.Loading.loadAttack=this.Loading.loadAttack=this.scene.time.delayedCall(i.wait,(function(){e.runAttack(i)}),void 0,this):this.runAttack(i)}function Cs(){this.BoneDirector.addSingle({x:-20,y:this.Commands.textsPos[0].y,visible:!0,length:30,tween:{targets:this,props:{x:this.Commands.textsPos[0].x+30},duration:800,repeat:-1,yoyo:!0,ease:"Quad.easeOut"}},"menu")}function Is(){for(var t=0,e=0,s=this.Commands.buttonPos;e<s.length;e++){var i=s[e];this.BoneDirector.addMulti({x:i.x+60,y:670,visible:!0,length:30,delay:1e3,count:-1,startAt:t,tween:{targets:this,props:{x:{value:i.x-60,duration:1e3},y:{value:i.y,hold:600,duration:200,yoyo:!0}},ease:"Sine.easeInOut"}},"menu"),t=t>0?0:500}}function Os(t){if(this.playerTurn=!0,t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var s=t[e];null!=s&&(this.endConfig[e]=s)}if(this.director.removeAll(),this.endConfig.win)!function(t,e){t.scene.transition({target:p.Scene.mainMenu,remove:!0,onUpdate:function(){var e=!0;t.cameras.cameras.forEach((function(t){t.alpha-=.01,t.alpha>0&&(e=!1)})),e&&(t.scene.setVisible(!0,p.Scene.mainMenu),t.scene.get(p.Scene.mainMenu).cameras.cameras.forEach((function(t){t.alpha+=.01})))},duration:5e3,data:[e]}),t.scene.setVisible(!1,p.Scene.mainMenu),t.scene.get(p.Scene.mainMenu).cameras.cameras.forEach((function(t){t.alpha=0}))}(this.scene,this.scene.config);else{var i=this.director;if(i.Heart.playerTurnInit(),i.CombatzoneDirector.setRectDefault(),this.endConfig.endPhase&&(this.endConfig.endPhase=!1,this.resting=!0),i.Commands.playerTurnInit(),this.endConfig.stopBGM&&(this.scene.sound.stopByKey(p.Audio.BGM),this.endConfig.stopBGM=!1),this.endConfig.playBGM&&(this.endConfig.playBGM=!1,this.scene.sound.play(p.Audio.BGM,{loop:!0})),this.endConfig.setSansVisual&&(i.Sans.setVisual(this.endConfig.setSansVisual),delete this.endConfig.setSansVisual),this.endConfig.menuBone)switch(this.endConfig.menuBone){case 1:Cs.call(i);break;case 2:Is.call(i);break;case 3:Cs.call(i),Is.call(i)}}}const Rs=function(){function t(){}return t.reload=function(t,e){t.sound.stopByKey(p.Audio.BGM),t.sound.play(p.Audio.BGM,{loop:!0}),e.CombatzoneDirector.setRectDefault(!0)},t}();function Ms(t){var e,s=this.director;s.Commands.endPlayerTurn(),s.Heart.enemyTurnInit(),s.removeAll(),this.playerTurn=!1,this.runAttackPos=0,this.playSingle=null!=t&&t,this.playSingle?(Rs.reload(this.scene,this.director),this.startAttack()):(this.attacked&&this.resting&&(this.resting=!1,this.nextPhase()),this.resting?this.scene.time.delayedCall(700,this.endEnemyTurn,void 0,this):(e=this.getAttack(),this.startAttack(e.attacks)))}function js(t){t.single&&(this.attackName=this.scene.config.singleAttack,this.loadingAttack=this.scene.cache.json.get(this.scene.config.singleAttack).attacks),this.endPlayerTurn(t.single)}function Ls(t){for(var e in this.Loading)if(Object.prototype.hasOwnProperty.call(this.Loading,e)){var s=this.Loading[e];s&&s.remove()}this.scene.config.settings&&this.scene.config.settings.practice&&Ss.showPassed(this.scene,!0),this.first=!1,this.runAttackPos=0;var i=this.director;if(this.playSingle)i.removeAll(),i.Heart.enemyTurnInit(),i.CombatzoneDirector.setRectDefault(!0),this.startAttack();else if(this.scene.config.settings&&this.scene.config.settings.practice)this.attacked=!0,this.endConfig.endPhase&&this.nextPhase(),Ss.endAttack(i),this.endPlayerTurn();else if(t){var n=w(t,{menuBone:{type:"number",default:0},setSansVisual:{type:["object","boolean"],default:!1},win:{type:"boolean",default:!1},playBGM:{type:"boolean",default:!1},stopBGM:{type:"boolean",default:!1},endPhase:{type:"boolean",default:!1}},this.director.AttackLoader.runAttackPos);this.endEnemyTurn(n)}else this.endEnemyTurn()}function Bs(t){var e;return null==t&&(t=!0),this.first?(this.first=!1,e=this.catchAttack()):this.attacked?(this.attacked=!1,t&&this.loadFilePos++,e=this.catchAttack()):e=this.catchRND(),e}const _s=function(){function t(t,e){this.scene=t,this.director=e,this.first=!0,this.playerTurn=!1,this.resting=!1,this.attacked=!1,this.playSingle=!1,this.runAttackPos=0,this.loadFilePos=0,this.phase=1,this.Loading={},this.endConfig={},this.runAttack=As,this.catchAttack=ks,this.catchRND=Ps,this.getAttack=Bs,this.endPlayerTurn=Ms,this.endEnemyTurn=Os,this.startAttack=Ds,this.retry=Ts,this.endAttack=Ls,this.startGame=js}return t.prototype.getPhaseLength=function(){switch(this.phase){case 1:default:return this.scene.config.Phase1.length;case 2:return this.scene.config.Phase2.length}},t.prototype.isPhaseEnd=function(){return!this.first&&(this.resting||this.loadFilePos+1>=this.getPhaseLength())},t.prototype.nextPhase=function(){this.first=!0,this.phase++,this.loadFilePos=0},t}();function Es(t){this.AttackLoader.startGame(t),this.Heart.Image.setCollisionCategory(this.heartCol)}const Ks=function(){function t(t,e,s,i){this.cursors=e,this.xKey=s,this.zKey=i,this.scene=t,this.Sans=new kt(t,320,170,this),this.SansText=new Ie(t,490,140,i,this),this.heartCol=1,this.AttackLoader=new _s(t,this),this.combatCol=2,this.CombatzoneDirector=new z(t,this.combatCol,this.heartCol,this),this.Statuses=new mt(t,this,410),this.Heart=new it(t,this.heartCol,this),this.Commands=new dt(t,this,this.Heart,this.CombatzoneDirector,this.Statuses),this.boneCol=3,this.BoneDirector=new he(t,this.boneCol,this),this.blasterCol=4,this.BlasterDirector=new ye(t,this.blasterCol,this),this.PlatFormCol=5,this.PlatFormDirector=new ys(t,this.PlatFormCol,this,this.heartCol),this.Debug=new je(t,this),this.Debug.setMode($s),this.Jumps=new Te(this),this.GameMath=new Ze(t,this),this.AudioPlayer=new ts(t,this),this.Effect=new xs(t,this),this.Statuses.setSetting(this.scene.config.settings||{}),this.searchVariable=Ue,this.removeAll=ws,this.startGame=Es}return t.prototype.update=function(t,e){this.scene&&(this.AttackLoader.playerTurn?this.Commands.update(this.cursors,this.xKey,this.zKey):this.Heart.update(this.cursors,t),this.CombatzoneDirector.update(),this.Sans.update(t),this.Statuses.update(t),this.BoneDirector.update(t),this.BlasterDirector.update(t,e),this.PlatFormDirector.update(),this.Debug.update(t,e),this.CombatzoneDirector.update(!0),this.xKey.ctrlKey&&(this.scene.config.single?this.scene.scene.start(p.Scene.singleSelect,this.scene.config):this.scene.scene.start(p.Scene.mainMenu,this.scene.config)))},t}();var Hs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),zs=function(t){function e(){var e=t.call(this,p.Scene.battleScene)||this;return e.color=0,e}return Hs(e,t),e.prototype.preload=function(){},e.prototype.init=function(){},e.prototype.create=function(t){this.config=t,this.xKey=this.input.keyboard.addKey("X"),this.zKey=this.input.keyboard.addKey("Z"),this.tKey=this.input.keyboard.addKey("T"),this.hKey=this.input.keyboard.addKey("H"),this.dKey=this.input.keyboard.addKey("D"),this.cursors=new f(this),this.director=new Ks(this,this.cursors,this.xKey,this.zKey),this.BackGround=new g(this),this.matter.world.setBounds(),this.director.startGame(this.config),console.log(this)},e.prototype.update=function(t,e){this.director.update(t,e),this.BackGround.update()},e}(Phaser.Scene);const Fs=zs;var Gs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const Ns=function(t){function e(){var e=t.call(this,p.Scene.gameOver)||this;return e.selected=0,e.buttons=[],e.canMove=!1,e}return Gs(e,t),e.prototype.create=function(t){this.config=t.config,this.selected=0,this.canMove=!1,this.cursors=new f(this),this.zKey=this.input.keyboard.addKey("Z"),this.heart=this.add.image(t.x,t.y,p.Image.heart).setTint(16711680),this.time.addEvent({delay:1e3,callback:this.secondCreate,callbackScope:this,args:[t]}),this.time.addEvent({delay:2e3,callback:this.thirdCreate,callbackScope:this})},e.prototype.secondCreate=function(t){this.sound.play(p.Audio.split),this.heart.setTexture(p.Image.break).setTint(16711680),this.shards=this.add.particles(p.Sheet.shard,void 0,{frame:["shard1","shard2","shard3"],x:t.x,y:t.y,speed:200,gravityY:200,lifespan:4e3,scale:1,delay:1e3,maxParticles:5,rotate:{start:-1800,end:1800,random:!0}}).setVisible(!1)},e.prototype.thirdCreate=function(){this.shards.setVisible(!0),this.sound.play(p.Audio.shatter),this.canMove=!0,this.heart.setVisible(!1);var t={fontFamily:"battlefont",fontSize:"128px"};this.add.text(320,140,"GAME\nOVER",t).setOrigin(.5),this.buttons[0]=this.add.text(170,310,"retry",t).setOrigin(.5).setScale(.4),this.buttons[1]=this.add.text(470,310,"return\nthe menu",t).setOrigin(.5).setScale(.4),this.selector=this.add.image(170,310,p.Image.heart).setTint(16711680)},e.prototype.update=function(t,e){if(this.canMove){this.cursors;var s=Phaser.Input.Keyboard.JustDown;if(this.cursors.leftIsJustDown||this.cursors.rightIsJustDown){this.selected=0===this.selected?1:0;var i=this.buttons[this.selected].x,n=this.buttons[this.selected].y;this.selector.setPosition(i,n),this.sound.play(p.Audio.cursor)}if(s(this.zKey))switch(this.selected){case 0:this.scene.start(p.Scene.battleScene,this.config);break;case 1:this.scene.start(p.Scene.mainMenu,this.config)}for(var o=0,a=this.buttons;o<a.length;o++)a[o].setTint(16777215);this.buttons[this.selected].setTint(16776960)}},e}(Phaser.Scene);var Vs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),Ys=function(t){function e(){var e=t.call(this,p.Scene.singleSelect)||this;return e.selected=0,e.delayTime=0,e.texts=[],e.lastDownTime={downKey:0,upKey:0},e}return Vs(e,t),e.prototype.preload=function(){},e.prototype.create=function(t){this.sound.stopAll(),this.config=t||{},this.xKey=this.input.keyboard.addKey("X"),this.zKey=this.input.keyboard.addKey("Z"),this.cursors=new f(this),this.BackGround=new g(this),this.selector=this.add.image(190,115,p.Image.heart),this.selector.setTint(16711680);var e={fontFamily:"battlefont",fontSize:"64px"},s={x:150,y:100};this.texts=[];var i=0;t:for(i=0;i<t.Phase1.length;i++){for(var n=t.Phase1[i],o=0,a=this.texts;o<a.length;o++){var r=a[o];if(n.slice(0,-5)===r.text)continue t}this.texts.push(this.add.text(s.x,s.y,n.slice(0,-5),e)),this.texts[this.texts.length-1].setScale(.5),s.y+=50}t:for(i=0;i<t.Phase1RND.length;i++){n=t.Phase1RND[i];for(var h=0,c=this.texts;h<c.length;h++)if(r=c[h],n.slice(0,-5)===r.text)continue t;this.texts.push(this.add.text(s.x,s.y,n.slice(0,-5),e)),this.texts[this.texts.length-1].setScale(.5).setTint(1044480),s.y+=50}t:for(i=0;i<t.Phase2.length;i++){n=t.Phase2[i];for(var l=0,d=this.texts;l<d.length;l++)if(r=d[l],n.slice(0,-5)===r.text)continue t;this.texts.push(this.add.text(s.x,s.y,n.slice(0,-5),e)),this.texts[this.texts.length-1].setScale(.5).setTint(p.Color.blue),s.y+=50}t:for(i=0;i<t.Phase2RND.length;i++){n=t.Phase2RND[i];for(var u=0,y=this.texts;u<y.length;u++)if(r=y[u],n.slice(0,-5)===r.text)continue t;this.texts.push(this.add.text(s.x,s.y,n.slice(0,-5),e)),this.texts[this.texts.length-1].setScale(.5).setTint(p.Color.orange),s.y+=50}this.cameras.main.startFollow(this.selector,!1,.1,.1,-100);for(var m=0,b=this.texts;m<b.length;m++)(r=b[m]).setVisible(!0)},e.prototype.update=function(t,e){this.BackGround.update(),this.cursors.upIsDown||(this.lastDownTime.upKey=t),this.cursors.downIsDown||(this.lastDownTime.downKey=t),(this.cursors.upIsJustDown||this.lastDownTime.upKey<t-750&&this.delayTime>4)&&(this.selected<=0||this.selected--,this.sound.play(p.Audio.cursor),this.delayTime=0,this.cursors.upIsJustDown&&(this.lastDownTime.upKey=t)),(this.cursors.downIsJustDown||this.lastDownTime.downKey<t-750&&this.delayTime>4)&&(this.selected>=this.texts.length-1||this.selected++,this.sound.play(p.Audio.cursor),this.delayTime=0,this.cursors.downIsJustDown&&(this.lastDownTime.downKey=t)),this.delayTime++,this.selector.setPosition(this.texts[this.selected].x-30,this.texts[this.selected].y+15),Phaser.Input.Keyboard.JustDown(this.zKey)&&(this.config.single=!0,this.config.singleAttack="".concat(this.texts[this.selected].text,".json"),this.scene.start(p.Scene.battleScene,this.config)),Phaser.Input.Keyboard.JustDown(this.xKey)&&(this.config.single=!1,this.config.singleAttack=void 0,this.scene.start(p.Scene.mainMenu,this.config))},e}(Phaser.Scene);const Ws=Ys;var Xs=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();const Zs=function(t){function e(){return t.call(this,p.Scene.pause)||this}return Xs(e,t),e.prototype.create=function(){this.tKey=this.input.keyboard.addKey("T"),this.cursors=new f(this)},e.prototype.update=function(){Phaser.Input.Keyboard.JustDown(this.tKey)&&(this.scene.stop(p.Scene.pause),this.scene.resume(p.Scene.battleScene))},e}(Phaser.Scene);var Js=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])},t(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}(),Us=function(t){function e(){var e=t.call(this,p.Scene.setting)||this;return e.settings={easyMode:!1,infHP:!1,infItem:!1,phase2:!1,practice:!1,noKr:!1,ignoreKr:!1},e.selected=0,e.texts=[],e}return Js(e,t),e.prototype.create=function(t){this.config=t,this.BackGround=new g(this),this.config.settings=this.settings,this.xKey=this.input.keyboard.addKey("X"),this.zKey=this.input.keyboard.addKey("Z"),this.cursors=new f(this),this.selector=this.add.image(190,115,p.Image.heart),this.selector.setTint(16711680),this.texts=[];for(var e={x:220,y:150},s={fontFamily:"battlefont",fontSize:"64px"},i=0;i<Object.keys(this.settings).length;i++){var n=Object.keys(this.settings)[i],o=this.add.text(e.x,e.y,n,s).setScale(.5);this.texts.push(o),this.settings[n]&&o.setTint(65280),e.y+=50}this.tweens.add({targets:this.texts[this.selected],props:{scaleX:.6,scaleY:.6},duration:100}),this.cameras.main.startFollow(this.selector,!1,.1,.1,-100)},e.prototype.update=function(){if(this.BackGround.update(),Phaser.Input.Keyboard.JustDown(this.xKey)&&(this.sound.play(p.Audio.select),this.scene.start(p.Scene.mainMenu,this.config)),Phaser.Input.Keyboard.JustDown(this.zKey)){this.sound.play(p.Audio.select);var t=Object.keys(this.settings)[this.selected];(this.settings[t]=!this.settings[t])?this.texts[this.selected].setTint(65280):this.texts[this.selected].setTint(16777215)}this.cursors.downIsJustDown&&(this.selected>=this.texts.length-1||(this.tweens.add({targets:this.texts[this.selected],props:{scaleX:.5,scaleY:.5},duration:100}),this.selected++,this.sound.play(p.Audio.cursor),this.tweens.add({targets:this.texts[this.selected],props:{scaleX:.6,scaleY:.6},duration:100}))),this.cursors.upIsJustDown&&(this.selected<=0||(this.tweens.add({targets:this.texts[this.selected],props:{scaleX:.5,scaleY:.5},duration:100}),this.selected--,this.sound.play(p.Audio.cursor),this.tweens.add({targets:this.texts[this.selected],props:{scaleX:.6,scaleY:.6},duration:100}))),this.selector.setPosition(this.texts[this.selected].x-30,this.texts[this.selected].y+15)},e}(Phaser.Scene);const qs=Us;var $s=!1,Qs={type:Phaser.AUTO,width:640,height:480,physics:{default:"matter",matter:{debug:!!$s&&{showVelocity:!0,showCollisions:!0,showAxes:!0,showBounds:!0,showBody:!0},gravity:{x:0,y:0}}},backgroundColor:"#000000",scene:[x,Ws,Fs,Ns,Zs,qs],pixelArt:!0};new Phaser.Game(Qs)})();